{"version":3,"file":"brew-auth.min.js","mappings":";CAAA,SAA2CA,EAAMC,GAC1B,iBAAZC,SAA0C,iBAAXC,OACxCA,OAAOD,QAAUD,EAAQG,QAAQ,WAAYA,QAAQ,aAC5B,mBAAXC,QAAyBA,OAAOC,IAC9CD,OAAO,+BAAgC,CAAC,UAAW,YAAaJ,GACtC,iBAAZC,QACdA,QAAc,KAAID,EAAQG,QAAQ,WAAYA,QAAQ,cAEtDJ,EAAW,KAAIA,EAAW,MAAK,CAAC,EAAGA,EAAW,KAAQ,KAAIC,EAAQD,EAAW,KAAGA,EAAW,MAC5F,CATD,CASGO,MAAM,SAASC,EAAkCC,GACpD,kB,oCCVAN,EAAOD,QAAUM,C,kBCAjBL,EAAOD,QAAUO,C,GCCbC,EAA2B,CAAC,EAGhC,SAASC,EAAoBC,GAE5B,IAAIC,EAAeH,EAAyBE,GAC5C,QAAqBE,IAAjBD,EACH,OAAOA,EAAaX,QAGrB,IAAIC,EAASO,EAAyBE,GAAY,CAGjDV,QAAS,CAAC,GAOX,OAHAa,EAAoBH,GAAUT,EAAQA,EAAOD,QAASS,GAG/CR,EAAOD,OACf,CCrBAS,EAAoBK,EAAI,SAASd,EAASe,GACzC,IAAI,IAAIC,KAAOD,EACXN,EAAoBQ,EAAEF,EAAYC,KAASP,EAAoBQ,EAAEjB,EAASgB,IAC5EE,OAAOC,eAAenB,EAASgB,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,IAG3E,ECPAP,EAAoBQ,EAAI,SAASK,EAAKC,GAAQ,OAAOL,OAAOM,UAAUC,eAAeC,KAAKJ,EAAKC,EAAO,ECCtGd,EAAoBkB,EAAI,SAAS3B,GACX,oBAAX4B,QAA0BA,OAAOC,aAC1CX,OAAOC,eAAenB,EAAS4B,OAAOC,YAAa,CAAEC,MAAO,WAE7DZ,OAAOC,eAAenB,EAAS,aAAc,CAAE8B,OAAO,GACvD,E,ybCLQC,EAAiBC,EAAAA,aCAjBC,EAAgBD,EAAAA,Y,SCAxBE,EAAgOF,EAAAA,KAAxNG,EAAUD,EAAVC,WAAYC,EAAoBF,EAApBE,qBAAsBC,EAAwBH,EAAxBG,yBAA0BC,EAAIJ,EAAJI,KAAMC,EAAaL,EAAbK,cAAeC,EAAON,EAAPM,QAASC,EAAMP,EAANO,OAAQC,EAAER,EAAFQ,GAAIC,EAAeT,EAAfS,gBAAiBC,EAAUV,EAAVU,WAAYC,EAASX,EAATW,UAAWC,EAASZ,EAATY,UAAWC,EAASb,EAATa,UAAWC,EAAId,EAAJc,KAAMC,EAAIf,EAAJe,KAAMC,EAAMhB,EAANgB,OAAQC,EAAOjB,EAAPiB,QAASC,EAAUlB,EAAVkB,WAAYC,EAAMnB,EAAA,OCAnNoB,EAAgBtB,EAAAA,IAAhBsB,YCDKC,EAAW,sBACXC,EAAa,wBACbC,EAAoB,+BCI3BC,EAAY,YAElB,EAAe3B,EAAa,OAAQ,CAAC,WAAW,SAAU4B,EAAKC,GAC3D,IAQIC,EACAC,EATAC,EAAU1B,EAAyBsB,EAAK,OAAQ,MAAM,GACtDK,EAAYnB,EAAUe,EAAQI,WAAaJ,EAAQK,UACnDC,EAAiB,CACjBC,YAAaP,EAAQO,aAAe,YAEpCC,EAAW,IAAIC,IACfC,EAAcrC,EAAYsC,SAASC,OAAQb,EAAIc,OAAO,MACtDC,EAAef,EAAIgB,MAIvB,SAASC,EAAaX,GAClB,IAAIY,EAAU,CACVP,YAAaA,EACbQ,cAAe,SAAUC,GACjBlB,IAAoBI,GAAcc,GAAajB,EAAciB,YAAcA,IAC3ElB,EAAkB,KACbF,EAAIqB,KAAK,iBACVC,IAGZ,GAGJ,OADAb,EAASc,IAAIjB,EAAUY,GAChB/B,EAAUmB,EAASkB,MAAMzD,KAAKuC,EAAUY,GAAQ,OAAO,SAAUO,GAC/DzC,EAAgByC,EAAGC,IACpB/B,EAAY8B,EAEpB,GACJ,CAEA,SAASE,EAAaC,EAAKvE,EAAKc,GAC5B,YAAiBlB,IAAVkB,EAAsByD,EAAMA,EAAIC,QAAO,SAAUC,GACpD,OAAOA,EAAEzE,KAASc,CACtB,GACJ,CAEA,SAAS4D,EAAaC,GAClB,GAAIA,EAAO1B,SACP,OAAOqB,EAAatB,EAAW,MAAO2B,EAAO1B,UAAU,GAE3D,IAAI2B,EAAU5B,EAGd,OAFA4B,EAAUN,EAAaM,EAAS,WAAYD,EAAOE,UACnDD,EAAUN,EAAaM,EAAS,eAAgBD,EAAOG,cACnDH,EAAOI,UACA5C,EAAQ,GAAG6C,MAAK,SAASC,EAAKC,GACjC,IAAIjC,EAAW2B,EAAQM,GACvB,OAAOjC,GAAYd,EAAQc,EAASkC,aAAaR,EAAOI,YAAYC,MAAK,SAAUP,GAC/E,OAAOA,EAAIxB,EAAWgC,EAAKC,EAAQ,EACvC,GACJ,IAECN,EAAQ,QAAb,EACWA,EAAQ,EAEvB,CAEA,SAASQ,EAAgBnC,EAAUoC,GAC/B3B,EAAaQ,IAAIxB,EAAW,CAAEO,SAAAA,EAAUoC,WAAAA,GAC5C,CAEA,SAASC,EAAgBrC,GACrB,IAAIsC,EAAQxD,EAAU2B,EAAchB,IAAc,CAAC,EAC/C6C,EAAMtC,WAAaA,GACnB9B,EAAWwB,EAAI6C,SAASD,EAAMF,YAEtC,CAEA,SAASI,EAAYxC,EAAUyC,GAC3B,IAAIC,EAAO,CACP1C,SAAUA,EAASjD,IACnB8E,aAAc7B,EAAS6B,aACvBc,QAASF,EAAOE,SAIpB,OAFA/C,EAAkBI,EAClBH,EAAgB4C,GACR9C,EAAQiD,YAAc/D,EAAUc,EAAQiD,YAAlB/D,CAA+B6D,GAAQxD,EAAQwD,EAAKC,UAAUZ,MAAK,SAAUc,GACvG/C,EAAQ+C,GACRR,EAAgBrC,EAASjD,KACzB2C,EAAIqB,KAAK,QAAS,CAAE8B,KAAAA,GACxB,IAAG,SAAUC,GAET,MADA9B,IACM8B,CACV,GACJ,CAEA,SAAS9B,IACL,IAAI6B,EAAOnD,EAAImD,KACfjD,EAAkB,KAClBC,EAAgB,KAChBC,EAAQ,MACRuC,EAAgB,IACZQ,GACAnD,EAAIqB,KAAK,SAAU,CAAE8B,KAAAA,GAE7B,CAEA,SAASE,EAAa/C,EAAUgD,EAAQtB,EAAQuB,GAC5C,IAAIC,EAAUrE,EAAUmB,EAASgD,IAASvF,KAAKuC,EAAUxB,EAAO,CAAC,EAAGyB,EAAgByB,GAASvB,EAAS/C,IAAI4C,IAI1G,OAHAkD,EAAO,OAAO,WACVzC,EAAY,OAAQhB,EACxB,IACOyD,EAAQnB,KAAKkB,EACxB,CAEAvD,EAAIxD,OAAO,CACPiH,oBAAqB,SAAUzB,GAC3B,OAAOxC,EAAQuC,EAAaC,IAASK,MAAK,SAAU/B,GAChD,OAAOA,EAAWjB,EAAKiB,EAAU,CAAC,MAAO,WAAY,iBAAmB,IAC5E,GACJ,EACAoD,aAAc,SAAUH,GACpB,IAAIjD,EAAWJ,EACX6C,EAAS5C,EACTwD,GAAqB,IAAbJ,EAEZ,OADAA,EAAWtE,EAAWsE,IAAa/D,EAC9Bc,GAGAqD,GAASxD,EAAcyD,UAAYC,KAAKC,MAClCP,EAASpD,EAAc4D,aAAa,GAExCzD,EAAS0D,QAAQ7D,EAAeM,EAAS/C,IAAI4C,IAAW+B,MAAK,SAAUU,GAI1E,OAHI7C,IAAoBI,IACpBH,EAAgB4C,GAEbQ,EAASR,EAAOgB,aAAa,EACxC,IAAG,SAAUX,GACT,OAAOO,EAAQjE,EAAO0D,GAASG,EAASR,EAAOgB,aAAa,EAChE,IAZWR,EAAS,MAAM,EAa9B,EACAU,MAAO,SAAUjC,GACb,OAAI9B,EACOX,EAAOX,EAAc8C,IAGzBlC,EAAQuC,EADfC,EAASA,GAAU,CAAC,IACiBK,MAAK,SAAU/B,GAChD,IAAKA,EACD,MAAM1B,EAAc8C,GAGxB,OADAe,EAAgBnC,EAASjD,IAAK2E,EAAOU,YAAczC,EAAQiE,eAAiBlE,EAAImE,MACzEd,EAAa/C,EAAU,QAASjB,EAAK2C,EAAQ,CAAC,YAAa,aAAcc,EAAYsB,KAAK,EAAG9D,GACxG,GACJ,EACA+D,OAAQ,SAAUrC,GACd,OAAK9B,GAILuC,EAAgB,IADhBT,EAASA,GAAU,CAAC,GACOU,YAAczC,EAAQqE,gBAAkBtE,EAAImE,MAChEd,EAAanD,EAAiB,SAAU,CAC3CkB,UAAWjB,EAAciB,UACzBmD,aAAcvC,EAAOuC,cACtBjD,IAPQ9B,EAAQ8B,IAQvB,IAGJtB,EAAIwE,YAAW,WACX,OAAO/E,EAAWY,EAAUoE,IAAIxD,IAAe,SAAUyD,GACrD,IAAInC,EAAQlC,EAAUsE,QAAQ5C,EAAahB,EAAarD,IAAIqC,IAAc,CAAC,IAI3E,OAHK2E,EAAQnC,KACTA,EAAQmC,EAAQE,UAAUtF,IAEvBiD,GAAS,EAAIO,EAAYzC,EAAUkC,GAAQmC,EAAQnC,IAAO,MAAO5C,GAAe2B,GAC3F,GACJ,GACJ,IC9KQ8C,EAAS/F,EAAAA,KAAT+F,KCqDR,EAnDqB,CACjBS,KAAM,SAAUxH,EAAKyH,GACjB,IAAIC,EAAUC,OAAOC,aACjBC,EAAa,aAAe7H,EAC5B8H,EAAeD,EAAa,MAQhC,SAASE,EAAepC,GAQpB,OAPIA,GACA+B,EAAQG,GAAcG,KAAKC,UAAUzG,EAAQmE,EAAM,CAAC,aACpD+B,EAAQI,GAAgBnC,EAAK5B,mBAEtB2D,EAAQG,UACRH,EAAQI,IAEZnC,CACX,CAEA,MAAO,CACH3F,IAAKA,EACL6E,SAAU4C,EAAO5C,SACjBC,aAAc2C,EAAO3C,aACrBX,KAAM,SAAUN,GACZkD,EAAKY,OAAQ,WAAW,SAAUvD,GAC1BA,EAAE8D,cAAgBR,IAAatD,EAAEpE,MAAQ8H,GAAgB1D,EAAE+D,UAAuB,OAAV/D,EAAEpE,MAC1E6D,EAAQC,cAAcM,EAAE+D,SAEhC,IACA,IAAIC,EA3BZ,WACI,IACI,OAAOJ,KAAKK,MAAMX,EAAQG,GAC9B,CAAE,MAAOzD,GAAK,CAClB,CAuBqBkE,GACb,OAAOF,GAAUX,EAAOd,QAAQyB,GAAQpD,KAAK+C,EACjD,EACAnB,MAAO,SAAUjC,GACb,OAAO8C,EAAOb,MAAMjC,GAAQK,KAAK+C,EACrC,EACAf,OAAQ,SAAUrC,GACd,OAAO8C,EAAOT,OAAOrC,GAAQK,KAAK+C,EAAehB,KAAK,OAAGnH,GAC7D,EACA+G,QAAS,SAAUyB,GACf,OAAOX,EAAOd,QAAQyB,GAAQpD,KAAK+C,EACvC,EACA5C,aAAc,SAAUJ,GACpB,OAAO0C,EAAOtC,aAAaJ,EAC/B,EAER,GClDEwD,EAAuB,gBAE7B,SAASC,EAAWnC,EAAcoC,EAAUC,EAAWxC,EAAUyC,GAC7D,OAAOD,GAAaD,GAAgC,MAApBA,EAASG,OAAiBvC,GAAa,GAAMrB,KAAKkB,EAAUyC,GAAWA,GAC3G,CAEA,SAASE,EAAgBxC,EAAc7B,EAAQsE,EAAS7D,GACpD,OAAKvD,EAAGoH,EAASC,UAAa9D,IAASrD,EAAWqD,GACvC4D,EAAgBxC,EAAc7B,EAAQ,IAAIuE,QAAQD,EAAS7D,KAEtEA,EAAOA,GAAQ0C,OAAOqB,MACjBxE,IAAWA,EAAOsE,IAAaA,EAAQG,QAAQC,IAAIX,GAC7CtD,EAAK6D,GAETzC,GAAa,SAAS8C,EAAQzC,EAAagC,GAC9C,IAAIU,EAAMN,EAKV,OAJIpC,IACA0C,EAAMA,EAAIC,SACNJ,QAAQ/E,IAAIqE,EAAsB,UAAY7B,GAE/CzB,EAAKmE,GAAKpE,MAAK,SAAUyD,GAC5B,OAAOD,EAAWnC,EAAcoC,EAAUC,EAAWS,GAAS,WAC1D,OAAOV,CACX,GACJ,GACJ,IACJ,CAEA,SAASa,EAAgBjD,EAAc7B,EAAQ+E,GAC3C,IAAIC,EAAU,IAAIC,QACdC,EAAkB,SAAUC,EAAQjD,GAEpC,OADAiD,EAAOV,QAAQV,GAAwB,UAAY7B,EAC5CiD,CACX,EAkBA,OAjBAJ,EAAMK,aAAad,QAAQe,KAAI,SAAUF,GACrC,OAAKnF,IAAWA,EAAOmF,IAAYA,EAAOV,QAAQV,GACvCoB,EAEJtD,GAAa,SAAUK,EAAagC,GAEvC,OADAc,EAAQtF,IAAIyF,EAAQjB,GACbhC,EAAcgD,EAAgBC,EAAQjD,GAAeiD,CAChE,GACJ,IACAJ,EAAMK,aAAanB,SAASoB,SAAIjK,GAAW,SAAUmG,GAEjD,OAAOyC,EAAWnC,GADlBN,EAAQA,GAAS,CAAC,GACoB0C,SAAUe,EAAQnJ,IAAI0F,EAAM4D,SAAS,SAAUjD,GACjF,OAAO6C,EAAMO,QAANP,CAAeG,EAAgB3D,EAAM4D,OAAQjD,GACxD,IAAG,WACC,OAAOxE,EAAO6D,EAClB,GACJ,IACOwD,CACX,CAEO,SAASQ,EAAsBpH,EAAK6B,GACvC,OAAOqE,EAAgB9B,KAAK,EAAGpE,EAAI0D,aAAc7B,EACrD,CAEO,SAASwF,EAAsBrH,EAAK6B,GACvC,OAAO8E,EAAgBvC,KAAK,EAAGpE,EAAI0D,aAAc7B,EACrD,CC7DA,IACQyF,EADUjJ,EAAAA,UACViJ,SCcR,SAASC,EAAazB,EAAU9C,EAAMI,GAClC,GAAI0C,EAAS0B,GACT,OAAOxE,EAEX,MAAMpE,EAAkC,MAApBkH,EAASG,OAAiBvE,EAA8B+F,EAAoB,GAAI,CAChGzE,KAAMA,EACNI,MAAOA,GAAS,KAChB6C,OAAQH,EAASG,QAEzB,CAEA,SAASyB,EAAUvB,EAAS7D,GAExB,OADA6D,EAAQG,QAAQ/E,IAAI,SAAU,qBACtBe,GAAQ+D,OAAOF,GAAS9D,MAAK,SAAUyD,GAC3C,OAAOA,EAAS6B,OAAOtF,MAAK,SAAUW,GAClC,OAAOuE,EAAazB,EAAU9C,EAClC,IAAG,SAAUvB,GAET,OAAO8F,EAAazB,EAAU,KAAMrE,EACxC,GACJ,GACJ,CAEA,SAASmG,EAAWC,EAASC,GACzBA,EAAaA,GAAc,SAAU3B,EAAS7D,GAC1C,OAAOA,EAAK6D,EAChB,EACA4B,KAAKF,QAAUA,EACfE,KAAK5B,QAAU,SAAUA,EAASlG,GAE9B,OADAkG,EAAUpH,EAAGoH,EAASC,UAAY,IAAIA,QAAQ9H,EAAYuJ,EAAS1B,GAAUlG,GACtE6H,EAAW3B,EAASuB,EAC/B,CACJ,CAEA/I,EAAK,6BAA6B,SAAUqJ,EAAGlG,GAC3C,IAAIwB,EAASxB,EAAEmG,cACfxJ,EAAqBmJ,EAAW/J,UAAWiE,GAAG,SAAUqC,EAAM+D,EAAMjI,GAChE,OAAO8H,KAAK5B,QAAQhC,EAAY,QAANrC,EAAcoG,EAhDhD,SAA4B5E,EAAQ4E,EAAMjI,GAEtC,OAAOnB,EAAO,CAAC,EADfmB,EAAUA,GAAW,CAAC,EACK,CACvBqD,OAAQA,EACR4E,KAAM7C,KAAKC,UAAU4C,GACrB5B,QAASxH,EAAO,CAAC,EAAGmB,EAAQqG,QAAS,CACjC,eAAgB,sBAG5B,CAuCuD6B,CAAmB7E,EAAQ4E,EAAMjI,GACpF,GACJ,IAEA,QCrDA,ICDA1C,OAAO6K,OAAOC,EAAMC,GACpB,O,gBnBMA,E","sources":["webpack://brew-extension-auth/webpack/universalModuleDefinition","webpack://brew-extension-auth/external umd {\"commonjs\":\"brew-js\",\"commonjs2\":\"brew-js\",\"amd\":\"brew-js\",\"root\":\"brew\"}","webpack://brew-extension-auth/external umd {\"commonjs\":\"zeta-dom\",\"commonjs2\":\"zeta-dom\",\"amd\":\"zeta-dom\",\"root\":\"zeta\"}","webpack://brew-extension-auth/webpack/bootstrap","webpack://brew-extension-auth/webpack/runtime/define property getters","webpack://brew-extension-auth/webpack/runtime/hasOwnProperty shorthand","webpack://brew-extension-auth/webpack/runtime/make namespace object","webpack://brew-extension-auth/../brew-extension-auth|umd|C:/brew-js/app.js","webpack://brew-extension-auth/../brew-extension-auth|umd|C:/brew-js/util/path.js","webpack://brew-extension-auth/../brew-extension-auth|umd|C:/zeta-dom/util.js","webpack://brew-extension-auth/../brew-extension-auth|umd|C:/zeta-dom/dom.js","webpack://brew-extension-auth/./src/errorCode.js","webpack://brew-extension-auth/./src/extension.js","webpack://brew-extension-auth/../brew-extension-auth|umd|C:/zeta-dom/domUtil.js","webpack://brew-extension-auth/./src/provider.js","webpack://brew-extension-auth/./src/middleware.js","webpack://brew-extension-auth/../brew-extension-auth|umd|C:/brew-js/errorCode.js","webpack://brew-extension-auth/./src/util/JSONClient.js","webpack://brew-extension-auth/./src/index.js","webpack://brew-extension-auth/./src/entry.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"brew-js\"), require(\"zeta-dom\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"@misonou/brew-extension-auth\", [\"brew-js\", \"zeta-dom\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Auth\"] = factory(require(\"brew-js\"), require(\"zeta-dom\"));\n\telse\n\t\troot[\"brew\"] = root[\"brew\"] || {}, root[\"brew\"][\"Auth\"] = factory(root[\"brew\"], root[\"zeta\"]);\n})(self, function(__WEBPACK_EXTERNAL_MODULE__760__, __WEBPACK_EXTERNAL_MODULE__231__) {\nreturn ","module.exports = __WEBPACK_EXTERNAL_MODULE__760__;","module.exports = __WEBPACK_EXTERNAL_MODULE__231__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import lib from \"brew-js\";\r\nconst { addExtension } = lib;\r\nexport { addExtension };","import lib from \"brew-js\";\r\nconst { combinePath } = lib;\r\nexport { combinePath };","import lib from \"zeta-dom\";\r\nconst { catchAsync, defineHiddenProperty, defineObservableProperty, each, errorWithCode, exclude, extend, is, isErrorWithCode, isFunction, makeArray, makeAsync, mapRemove, pick, pipe, reject, resolve, resolveAll, throws } = lib.util;\r\nexport { catchAsync, defineHiddenProperty, defineObservableProperty, each, errorWithCode, exclude, extend, is, isErrorWithCode, isFunction, makeArray, makeAsync, mapRemove, pick, pipe, reject, resolve, resolveAll, throws };","import lib from \"zeta-dom\";\r\nconst { reportError } = lib.dom;\r\nexport { reportError };","export const loggedIn = 'brew/auth-logged-in';\r\nexport const noProvider = 'brew/auth-no-provider';\r\nexport const invalidCredential = 'brew/auth-invalid-credential';\r\n","import { addExtension } from \"brew-js/app\";\r\nimport { combinePath } from \"brew-js/util/path\";\r\nimport { catchAsync, defineObservableProperty, errorWithCode, extend, isErrorWithCode, isFunction, makeArray, makeAsync, mapRemove, pick, pipe, reject, resolve, resolveAll, throws } from \"zeta-dom/util\";\r\nimport { reportError } from \"zeta-dom/dom\";\r\nimport * as AuthError from \"./errorCode.js\";\r\n\r\nconst CACHE_KEY = 'brew.auth';\r\n\r\nexport default addExtension('auth', ['router'], function (app, options) {\r\n    var setUser = defineObservableProperty(app, 'user', null, true);\r\n    var providers = makeArray(options.providers || options.provider);\r\n    var providerParams = {\r\n        interaction: options.interaction || 'redirect',\r\n    };\r\n    var contexts = new Map();\r\n    var redirectUri = combinePath(location.origin, app.toHref('/'));\r\n    var sessionCache = app.cache;\r\n    var currentProvider;\r\n    var currentResult;\r\n\r\n    function initProvider(provider) {\r\n        var context = {\r\n            redirectUri: redirectUri,\r\n            revokeSession: function (accountId) {\r\n                if (currentProvider === provider && (!accountId || currentResult.accountId === accountId)) {\r\n                    currentProvider = null;\r\n                    if (!app.emit('sessionEnded')) {\r\n                        handleLogout();\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        contexts.set(provider, context);\r\n        return makeAsync(provider.init).call(provider, context).catch(function (e) {\r\n            if (!isErrorWithCode(e, AuthError.invalidCredential)) {\r\n                reportError(e);\r\n            }\r\n        });\r\n    }\r\n\r\n    function filterByProp(arr, key, value) {\r\n        return value === undefined ? arr : arr.filter(function (v) {\r\n            return v[key] === value;\r\n        });\r\n    }\r\n\r\n    function findProvider(params) {\r\n        if (params.provider) {\r\n            return filterByProp(providers, 'key', params.provider)[0];\r\n        }\r\n        var matched = providers;\r\n        matched = filterByProp(matched, 'authType', params.authType);\r\n        matched = filterByProp(matched, 'providerType', params.providerType);\r\n        if (params.loginHint) {\r\n            return resolve(0).then(function next(index) {\r\n                var provider = matched[index];\r\n                return provider && resolve(provider.isHandleable(params.loginHint)).then(function (v) {\r\n                    return v ? provider : next(index + 1);\r\n                });\r\n            });\r\n        }\r\n        if (!matched[1]) {\r\n            return matched[0];\r\n        }\r\n    }\r\n\r\n    function setSessionState(provider, returnPath) {\r\n        sessionCache.set(CACHE_KEY, { provider, returnPath });\r\n    }\r\n\r\n    function popSessionState(provider) {\r\n        var state = mapRemove(sessionCache, CACHE_KEY) || {};\r\n        if (state.provider === provider) {\r\n            catchAsync(app.navigate(state.returnPath));\r\n        }\r\n    }\r\n\r\n    function handleLogin(provider, result) {\r\n        var data = {\r\n            provider: provider.key,\r\n            providerType: provider.providerType,\r\n            account: result.account\r\n        };\r\n        currentProvider = provider;\r\n        currentResult = result;\r\n        return (options.resolveUser ? makeAsync(options.resolveUser)(data) : resolve(data.account)).then(function (user) {\r\n            setUser(user);\r\n            popSessionState(provider.key);\r\n            app.emit('login', { user });\r\n        }, function (error) {\r\n            handleLogout();\r\n            throw error;\r\n        });\r\n    }\r\n\r\n    function handleLogout() {\r\n        var user = app.user;\r\n        currentProvider = null;\r\n        currentResult = null;\r\n        setUser(null);\r\n        popSessionState('');\r\n        if (user) {\r\n            app.emit('logout', { user });\r\n        }\r\n    }\r\n\r\n    function callProvider(provider, method, params, callback) {\r\n        var promise = makeAsync(provider[method]).call(provider, extend({}, providerParams, params), contexts.get(provider));\r\n        promise.catch(function () {\r\n            sessionCache.delete(CACHE_KEY);\r\n        });\r\n        return promise.then(callback);\r\n    }\r\n\r\n    app.define({\r\n        resolveAuthProvider: function (params) {\r\n            return resolve(findProvider(params)).then(function (provider) {\r\n                return provider ? pick(provider, ['key', 'authType', 'providerType']) : null;\r\n            });\r\n        },\r\n        acquireToken: function (callback) {\r\n            var provider = currentProvider;\r\n            var result = currentResult;\r\n            var force = callback === true;\r\n            callback = isFunction(callback) || resolve;\r\n            if (!provider) {\r\n                return callback(null, false);\r\n            }\r\n            if (!force && currentResult.expiresOn > Date.now()) {\r\n                return callback(currentResult.accessToken, true);\r\n            }\r\n            return provider.refresh(currentResult, contexts.get(provider)).then(function (result) {\r\n                if (currentProvider === provider) {\r\n                    currentResult = result;\r\n                }\r\n                return callback(result.accessToken, false);\r\n            }, function (error) {\r\n                return force ? throws(error) : callback(result.accessToken, false);\r\n            });\r\n        },\r\n        login: function (params) {\r\n            if (currentProvider) {\r\n                return reject(errorWithCode(AuthError.loggedIn));\r\n            }\r\n            params = params || {};\r\n            return resolve(findProvider(params)).then(function (provider) {\r\n                if (!provider) {\r\n                    throw errorWithCode(AuthError.noProvider);\r\n                }\r\n                setSessionState(provider.key, params.returnPath || options.postLoginPath || app.path);\r\n                return callProvider(provider, 'login', pick(params, ['loginHint', 'password']), handleLogin.bind(0, provider));\r\n            });\r\n        },\r\n        logout: function (params) {\r\n            if (!currentProvider) {\r\n                return resolve(handleLogout());\r\n            }\r\n            params = params || {};\r\n            setSessionState('', params.returnPath || options.postLogoutPath || app.path);\r\n            return callProvider(currentProvider, 'logout', {\r\n                accountId: currentResult.accountId,\r\n                singleLogout: params.singleLogout\r\n            }, handleLogout);\r\n        }\r\n    });\r\n\r\n    app.beforeInit(function () {\r\n        return resolveAll(providers.map(initProvider), function (results) {\r\n            var index = providers.indexOf(findProvider(sessionCache.get(CACHE_KEY) || {}));\r\n            if (!results[index]) {\r\n                index = results.findIndex(pipe);\r\n            }\r\n            return index >= 0 ? handleLogin(providers[index], results[index]).catch(reportError) : handleLogout();\r\n        });\r\n    });\r\n});\r\n","import lib from \"zeta-dom\";\r\nconst { bind } = lib.util;\r\nexport { bind };","import { bind } from \"zeta-dom/domUtil\";\r\nimport { exclude } from \"zeta-dom/util\";\r\n\r\nconst AuthProvider = {\r\n    from: function (key, client) {\r\n        var storage = window.localStorage;\r\n        var storageKey = 'brew.auth.' + key;\r\n        var storageKeyID = storageKey + '.id';\r\n\r\n        function getCachedData() {\r\n            try {\r\n                return JSON.parse(storage[storageKey]);\r\n            } catch (e) { }\r\n        }\r\n\r\n        function setCurrentData(data) {\r\n            if (data) {\r\n                storage[storageKey] = JSON.stringify(exclude(data, ['account']));\r\n                storage[storageKeyID] = data.accountId;\r\n            } else {\r\n                delete storage[storageKey];\r\n                delete storage[storageKeyID];\r\n            }\r\n            return data;\r\n        }\r\n\r\n        return {\r\n            key: key,\r\n            authType: client.authType,\r\n            providerType: client.providerType,\r\n            init: function (context) {\r\n                bind(window, 'storage', function (e) {\r\n                    if (e.storageArea === storage && ((e.key === storageKeyID && e.oldValue) || e.key === null)) {\r\n                        context.revokeSession(e.oldValue);\r\n                    }\r\n                });\r\n                var cached = getCachedData();\r\n                return cached && client.refresh(cached).then(setCurrentData);\r\n            },\r\n            login: function (params) {\r\n                return client.login(params).then(setCurrentData);\r\n            },\r\n            logout: function (params) {\r\n                return client.logout(params).then(setCurrentData.bind(0, undefined));\r\n            },\r\n            refresh: function (cached) {\r\n                return client.refresh(cached).then(setCurrentData);\r\n            },\r\n            isHandleable: function (loginHint) {\r\n                return client.isHandleable(loginHint);\r\n            }\r\n        };\r\n    }\r\n};\r\nexport default AuthProvider;\r\n","import { is, isFunction, reject } from \"zeta-dom/util\";\r\n\r\nconst HEADER_AUTHORIZATION = 'authorization';\r\n\r\nfunction retryOrEnd(acquireToken, response, retryable, callback, onError) {\r\n    return retryable && response && response.status === 401 ? acquireToken(true).then(callback, onError) : onError();\r\n}\r\n\r\nfunction fetchMiddleware(acquireToken, filter, request, next) {\r\n    if (!is(request, Request) || (next && !isFunction(next))) {\r\n        return fetchMiddleware(acquireToken, filter, new Request(request, next));\r\n    }\r\n    next = next || window.fetch;\r\n    if ((filter && !filter(request)) || request.headers.has(HEADER_AUTHORIZATION)) {\r\n        return next(request);\r\n    }\r\n    return acquireToken(function execute(accessToken, retryable) {\r\n        var req = request;\r\n        if (accessToken) {\r\n            req = req.clone();\r\n            req.headers.set(HEADER_AUTHORIZATION, 'Bearer ' + accessToken);\r\n        }\r\n        return next(req).then(function (response) {\r\n            return retryOrEnd(acquireToken, response, retryable, execute, function () {\r\n                return response;\r\n            });\r\n        });\r\n    });\r\n}\r\n\r\nfunction axiosMiddleware(acquireToken, filter, axios) {\r\n    var handled = new WeakMap();\r\n    var withBearerToken = function (config, accessToken) {\r\n        config.headers[HEADER_AUTHORIZATION] = 'Bearer ' + accessToken;\r\n        return config;\r\n    };\r\n    axios.interceptors.request.use(function (config) {\r\n        if ((filter && !filter(config)) || config.headers[HEADER_AUTHORIZATION]) {\r\n            return config;\r\n        }\r\n        return acquireToken(function (accessToken, retryable) {\r\n            handled.set(config, retryable);\r\n            return accessToken ? withBearerToken(config, accessToken) : config;\r\n        });\r\n    });\r\n    axios.interceptors.response.use(undefined, function (error) {\r\n        error = error || {};\r\n        return retryOrEnd(acquireToken, error.response, handled.get(error.config), function (accessToken) {\r\n            return axios.create()(withBearerToken(error.config, accessToken));\r\n        }, function () {\r\n            return reject(error);\r\n        });\r\n    });\r\n    return axios;\r\n}\r\n\r\nexport function createFetchMiddleware(app, filter) {\r\n    return fetchMiddleware.bind(0, app.acquireToken, filter);\r\n}\r\n\r\nexport function createAxiosMiddleware(app, filter) {\r\n    return axiosMiddleware.bind(0, app.acquireToken, filter);\r\n}\r\n","import lib from \"brew-js\";\r\nconst errorCode = lib.ErrorCode;\r\nconst { apiError } = errorCode;\r\nexport { apiError };","import { defineHiddenProperty, each, errorWithCode, extend, is } from \"zeta-dom/util\";\r\nimport { combinePath } from \"brew-js/util/path\";\r\nimport * as BrewError from \"brew-js/errorCode\";\r\nimport * as AuthError from \"../errorCode.js\";\r\n\r\nfunction getOptionsWithBody(method, body, options) {\r\n    options = options || {};\r\n    return extend({}, options, {\r\n        method: method,\r\n        body: JSON.stringify(body),\r\n        headers: extend({}, options.headers, {\r\n            'content-type': 'application/json'\r\n        })\r\n    });\r\n}\r\n\r\nfunction handleResult(response, data, error) {\r\n    if (response.ok) {\r\n        return data;\r\n    }\r\n    throw errorWithCode(response.status === 401 ? AuthError.invalidCredential : BrewError.apiError, '', {\r\n        data: data,\r\n        error: error || null,\r\n        status: response.status\r\n    });\r\n}\r\n\r\nfunction fetchJSON(request, next) {\r\n    request.headers.set('accept', 'application/json');\r\n    return (next || fetch)(request).then(function (response) {\r\n        return response.json().then(function (data) {\r\n            return handleResult(response, data);\r\n        }, function (e) {\r\n            // assume empty for non-JSON response with 2xx status\r\n            return handleResult(response, null, e);\r\n        });\r\n    });\r\n}\r\n\r\nfunction JSONClient(baseUrl, middleware) {\r\n    middleware = middleware || function (request, next) {\r\n        return next(request);\r\n    };\r\n    this.baseUrl = baseUrl;\r\n    this.request = function (request, options) {\r\n        request = is(request, Request) || new Request(combinePath(baseUrl, request), options);\r\n        return middleware(request, fetchJSON);\r\n    };\r\n}\r\n\r\neach('get post put patch delete', function (i, v) {\r\n    var method = v.toUpperCase();\r\n    defineHiddenProperty(JSONClient.prototype, v, function (path, body, options) {\r\n        return this.request(path, v === 'get' ? body : getOptionsWithBody(method, body, options));\r\n    });\r\n});\r\n\r\nexport default JSONClient;\r\n","import Auth from \"./extension.js\";\r\nimport * as AuthError from \"./errorCode.js\";\r\nimport AuthProvider from \"./provider.js\";\r\n\r\nexport default Auth;\r\nexport * from \"./middleware.js\";\r\nexport * from \"./util.js\";\r\n\r\nexport {\r\n    AuthError,\r\n    AuthProvider\r\n}\r\n","import Auth from \"./index.js\";\r\nimport * as methods from \"./index.js\";\r\n\r\nObject.assign(Auth, methods);\r\nexport default Auth;\r\n"],"names":["root","factory","exports","module","require","define","amd","self","__WEBPACK_EXTERNAL_MODULE__760__","__WEBPACK_EXTERNAL_MODULE__231__","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","d","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","addExtension","lib","combinePath","_lib$util","catchAsync","defineHiddenProperty","defineObservableProperty","each","errorWithCode","exclude","extend","is","isErrorWithCode","isFunction","makeArray","makeAsync","mapRemove","pick","pipe","reject","resolve","resolveAll","throws","reportError","loggedIn","noProvider","invalidCredential","CACHE_KEY","app","options","currentProvider","currentResult","setUser","providers","provider","providerParams","interaction","contexts","Map","redirectUri","location","origin","toHref","sessionCache","cache","initProvider","context","revokeSession","accountId","emit","handleLogout","set","init","e","AuthError","filterByProp","arr","filter","v","findProvider","params","matched","authType","providerType","loginHint","then","next","index","isHandleable","setSessionState","returnPath","popSessionState","state","navigate","handleLogin","result","data","account","resolveUser","user","error","callProvider","method","callback","promise","resolveAuthProvider","acquireToken","force","expiresOn","Date","now","accessToken","refresh","login","postLoginPath","path","bind","logout","postLogoutPath","singleLogout","beforeInit","map","results","indexOf","findIndex","from","client","storage","window","localStorage","storageKey","storageKeyID","setCurrentData","JSON","stringify","storageArea","oldValue","cached","parse","getCachedData","HEADER_AUTHORIZATION","retryOrEnd","response","retryable","onError","status","fetchMiddleware","request","Request","fetch","headers","has","execute","req","clone","axiosMiddleware","axios","handled","WeakMap","withBearerToken","config","interceptors","use","create","createFetchMiddleware","createAxiosMiddleware","apiError","handleResult","ok","BrewError","fetchJSON","json","JSONClient","baseUrl","middleware","this","i","toUpperCase","body","getOptionsWithBody","assign","Auth","methods"],"sourceRoot":""}