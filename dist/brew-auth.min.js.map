{"version":3,"file":"brew-auth.min.js","mappings":"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","sources":["webpack://brew-extension-auth/webpack/universalModuleDefinition","webpack://brew-extension-auth/external umd {\"commonjs\":\"brew-js\",\"commonjs2\":\"brew-js\",\"amd\":\"brew-js\",\"root\":\"brew\"}","webpack://brew-extension-auth/external umd {\"commonjs\":\"zeta-dom\",\"commonjs2\":\"zeta-dom\",\"amd\":\"zeta-dom\",\"root\":\"zeta\"}","webpack://brew-extension-auth/webpack/bootstrap","webpack://brew-extension-auth/webpack/runtime/define property getters","webpack://brew-extension-auth/webpack/runtime/hasOwnProperty shorthand","webpack://brew-extension-auth/webpack/runtime/make namespace object","webpack://brew-extension-auth/../brew-extension-auth|umd|C:/brew-js/app.js","webpack://brew-extension-auth/../brew-extension-auth|umd|C:/brew-js/util/path.js","webpack://brew-extension-auth/../brew-extension-auth|umd|C:/zeta-dom/util.js","webpack://brew-extension-auth/../brew-extension-auth|umd|C:/zeta-dom/dom.js","webpack://brew-extension-auth/./src/errorCode.js","webpack://brew-extension-auth/./src/extension.js","webpack://brew-extension-auth/../brew-extension-auth|umd|C:/zeta-dom/domUtil.js","webpack://brew-extension-auth/./src/provider.js","webpack://brew-extension-auth/./src/middleware.js","webpack://brew-extension-auth/../brew-extension-auth|umd|C:/brew-js/errorCode.js","webpack://brew-extension-auth/./src/util/JSONClient.js","webpack://brew-extension-auth/./src/index.js","webpack://brew-extension-auth/./src/entry.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"brew-js\"), require(\"zeta-dom\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"@misonou/brew-extension-auth\", [\"brew-js\", \"zeta-dom\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Auth\"] = factory(require(\"brew-js\"), require(\"zeta-dom\"));\n\telse\n\t\troot[\"brew\"] = root[\"brew\"] || {}, root[\"brew\"][\"Auth\"] = factory(root[\"brew\"], root[\"zeta\"]);\n})(self, function(__WEBPACK_EXTERNAL_MODULE__760__, __WEBPACK_EXTERNAL_MODULE__231__) {\nreturn ","module.exports = __WEBPACK_EXTERNAL_MODULE__760__;","module.exports = __WEBPACK_EXTERNAL_MODULE__231__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import lib from \"brew-js\";\r\nconst { addExtension } = lib;\r\nexport { addExtension };","import lib from \"brew-js\";\r\nconst { combinePath } = lib;\r\nexport { combinePath };","import lib from \"zeta-dom\";\r\nconst { catchAsync, defineHiddenProperty, defineObservableProperty, each, errorWithCode, exclude, extend, is, isFunction, makeArray, makeAsync, mapRemove, pick, pipe, reject, resolve, resolveAll, throws } = lib.util;\r\nexport { catchAsync, defineHiddenProperty, defineObservableProperty, each, errorWithCode, exclude, extend, is, isFunction, makeArray, makeAsync, mapRemove, pick, pipe, reject, resolve, resolveAll, throws };","import lib from \"zeta-dom\";\r\nconst { reportError } = lib.dom;\r\nexport { reportError };","export const loggedIn = 'brew/auth-logged-in';\r\nexport const noProvider = 'brew/auth-no-provider';\r\nexport const invalidCredential = 'brew/auth-invalid-credential';\r\n","import { addExtension } from \"brew-js/app\";\r\nimport { combinePath } from \"brew-js/util/path\";\r\nimport { catchAsync, defineObservableProperty, errorWithCode, extend, isFunction, makeArray, makeAsync, mapRemove, pick, pipe, reject, resolve, resolveAll, throws } from \"zeta-dom/util\";\r\nimport { reportError } from \"zeta-dom/dom\";\r\nimport * as AuthError from \"./errorCode.js\";\r\n\r\nconst CACHE_KEY = 'brew.auth';\r\n\r\nexport default addExtension('auth', ['router'], function (app, options) {\r\n    var setUser = defineObservableProperty(app, 'user', null, true);\r\n    var providers = makeArray(options.providers || options.provider);\r\n    var providerParams = {\r\n        interaction: options.interaction || 'redirect',\r\n    };\r\n    var contexts = new Map();\r\n    var redirectUri = combinePath(location.origin, app.toHref('/'));\r\n    var sessionCache = app.cache;\r\n    var currentProvider;\r\n    var currentResult;\r\n\r\n    function initProvider(provider) {\r\n        var context = {\r\n            redirectUri: redirectUri,\r\n            revokeSession: function (accountId) {\r\n                if (currentProvider === provider && (!accountId || currentResult.accountId === accountId)) {\r\n                    currentProvider = null;\r\n                    if (!app.emit('sessionEnded')) {\r\n                        handleLogout();\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        contexts.set(provider, context);\r\n        return resolve(provider.init(context)).catch(function (e) {\r\n            reportError(e);\r\n        });\r\n    }\r\n\r\n    function filterByProp(arr, key, value) {\r\n        return value === undefined ? arr : arr.filter(function (v) {\r\n            return v[key] === value;\r\n        });\r\n    }\r\n\r\n    function findProvider(params) {\r\n        if (params.provider) {\r\n            return filterByProp(providers, 'key', params.provider)[0];\r\n        }\r\n        var matched = providers;\r\n        matched = filterByProp(matched, 'authType', params.authType);\r\n        matched = filterByProp(matched, 'providerType', params.providerType);\r\n        if (params.loginHint) {\r\n            return resolve(0).then(function next(index) {\r\n                var provider = matched[index];\r\n                return provider && resolve(provider.isHandleable(params.loginHint)).then(function (v) {\r\n                    return v ? provider : next(index + 1);\r\n                });\r\n            });\r\n        }\r\n        if (!matched[1]) {\r\n            return matched[0];\r\n        }\r\n    }\r\n\r\n    function setSessionState(provider, returnPath) {\r\n        sessionCache.set(CACHE_KEY, { provider, returnPath });\r\n    }\r\n\r\n    function popSessionState(provider) {\r\n        var state = mapRemove(sessionCache, CACHE_KEY) || {};\r\n        if (state.provider === provider) {\r\n            catchAsync(app.navigate(state.returnPath));\r\n        }\r\n    }\r\n\r\n    function handleLogin(provider, result) {\r\n        var data = {\r\n            provider: provider.key,\r\n            providerType: provider.providerType,\r\n            account: result.account\r\n        };\r\n        currentProvider = provider;\r\n        currentResult = result;\r\n        return (options.resolveUser ? makeAsync(options.resolveUser)(data) : resolve(data.account)).then(function (user) {\r\n            setUser(user);\r\n            popSessionState(provider.key);\r\n            app.emit('login', { user });\r\n        }, function (error) {\r\n            handleLogout();\r\n            throw error;\r\n        });\r\n    }\r\n\r\n    function handleLogout() {\r\n        var user = app.user;\r\n        currentProvider = null;\r\n        currentResult = null;\r\n        setUser(null);\r\n        popSessionState('');\r\n        if (user) {\r\n            app.emit('logout', { user });\r\n        }\r\n    }\r\n\r\n    function callProvider(provider, method, params, callback) {\r\n        var promise = makeAsync(provider[method]).call(provider, extend({}, providerParams, params), contexts.get(provider));\r\n        promise.catch(function () {\r\n            sessionCache.delete(CACHE_KEY);\r\n        });\r\n        return promise.then(callback);\r\n    }\r\n\r\n    app.define({\r\n        resolveAuthProvider: function (params) {\r\n            return resolve(findProvider(params)).then(function (provider) {\r\n                return provider ? pick(provider, ['key', 'authType', 'providerType']) : null;\r\n            });\r\n        },\r\n        acquireToken: function (callback) {\r\n            var provider = currentProvider;\r\n            var result = currentResult;\r\n            var force = callback === true;\r\n            callback = isFunction(callback) || resolve;\r\n            if (!provider) {\r\n                return callback(null, false);\r\n            }\r\n            if (!force && currentResult.expiresOn > Date.now()) {\r\n                return callback(currentResult.accessToken, true);\r\n            }\r\n            return provider.refresh(currentResult, contexts.get(provider)).then(function (result) {\r\n                if (currentProvider === provider) {\r\n                    currentResult = result;\r\n                }\r\n                return callback(result.accessToken, false);\r\n            }, function (error) {\r\n                return force ? throws(error) : callback(result.accessToken, false);\r\n            });\r\n        },\r\n        login: function (params) {\r\n            if (currentProvider) {\r\n                return reject(errorWithCode(AuthError.loggedIn));\r\n            }\r\n            params = params || {};\r\n            return resolve(findProvider(params)).then(function (provider) {\r\n                if (!provider) {\r\n                    throw errorWithCode(AuthError.noProvider);\r\n                }\r\n                setSessionState(provider.key, params.returnPath || options.postLoginPath || app.path);\r\n                return callProvider(provider, 'login', pick(params, ['loginHint', 'password']), handleLogin.bind(0, provider));\r\n            });\r\n        },\r\n        logout: function (params) {\r\n            if (!currentProvider) {\r\n                return resolve(handleLogout());\r\n            }\r\n            params = params || {};\r\n            setSessionState('', params.returnPath || options.postLogoutPath || app.path);\r\n            return callProvider(currentProvider, 'logout', {\r\n                accountId: currentResult.accountId,\r\n                singleLogout: params.singleLogout\r\n            }, handleLogout);\r\n        }\r\n    });\r\n\r\n    app.beforeInit(function () {\r\n        return resolveAll(providers.map(initProvider), function (results) {\r\n            var index = providers.indexOf(findProvider(sessionCache.get(CACHE_KEY) || {}));\r\n            if (!results[index]) {\r\n                index = results.findIndex(pipe);\r\n            }\r\n            return index >= 0 ? handleLogin(providers[index], results[index]) : handleLogout();\r\n        });\r\n    });\r\n});\r\n","import lib from \"zeta-dom\";\r\nconst { bind } = lib.util;\r\nexport { bind };","import { bind } from \"zeta-dom/domUtil\";\r\nimport { exclude } from \"zeta-dom/util\";\r\n\r\nconst AuthProvider = {\r\n    from: function (key, client) {\r\n        var storage = window.localStorage;\r\n        var storageKey = 'brew.auth.' + key;\r\n        var storageKeyID = storageKey + '.id';\r\n\r\n        function getCachedData() {\r\n            try {\r\n                return JSON.parse(storage[storageKey]);\r\n            } catch (e) { }\r\n        }\r\n\r\n        function setCurrentData(data) {\r\n            if (data) {\r\n                storage[storageKey] = JSON.stringify(exclude(data, ['account']));\r\n                storage[storageKeyID] = data.accountId;\r\n            } else {\r\n                delete storage[storageKey];\r\n                delete storage[storageKeyID];\r\n            }\r\n            return data;\r\n        }\r\n\r\n        return {\r\n            key: key,\r\n            authType: client.authType,\r\n            providerType: client.providerType,\r\n            init: function (context) {\r\n                bind(window, 'storage', function (e) {\r\n                    if (e.storageArea === storage && ((e.key === storageKeyID && e.oldValue) || e.key === null)) {\r\n                        context.revokeSession(e.oldValue);\r\n                    }\r\n                });\r\n                var cached = getCachedData();\r\n                return cached && client.refresh(cached).then(setCurrentData);\r\n            },\r\n            login: function (params) {\r\n                return client.login(params).then(setCurrentData);\r\n            },\r\n            logout: function (params) {\r\n                return client.logout(params).then(setCurrentData.bind(0, undefined));\r\n            },\r\n            refresh: function (cached) {\r\n                return client.refresh(cached).then(setCurrentData);\r\n            },\r\n            isHandleable: function (loginHint) {\r\n                return client.isHandleable(loginHint);\r\n            }\r\n        };\r\n    }\r\n};\r\nexport default AuthProvider;\r\n","import { is, isFunction, reject } from \"zeta-dom/util\";\r\n\r\nconst HEADER_AUTHORIZATION = 'authorization';\r\n\r\nfunction retryOrEnd(acquireToken, response, retryable, callback, onError) {\r\n    return retryable && response && response.status === 401 ? acquireToken(true).then(callback, onError) : onError();\r\n}\r\n\r\nfunction fetchMiddleware(acquireToken, filter, request, next) {\r\n    if (!is(request, Request) || (next && !isFunction(next))) {\r\n        return fetchMiddleware(acquireToken, filter, new Request(request, next));\r\n    }\r\n    next = next || window.fetch;\r\n    if ((filter && !filter(request)) || request.headers.has(HEADER_AUTHORIZATION)) {\r\n        return next(request);\r\n    }\r\n    return acquireToken(function execute(accessToken, retryable) {\r\n        var req = request;\r\n        if (accessToken) {\r\n            req = req.clone();\r\n            req.headers.set(HEADER_AUTHORIZATION, 'Bearer ' + accessToken);\r\n        }\r\n        return next(req).then(function (response) {\r\n            return retryOrEnd(acquireToken, response, retryable, execute, function () {\r\n                return response;\r\n            });\r\n        });\r\n    });\r\n}\r\n\r\nfunction axiosMiddleware(acquireToken, filter, axios) {\r\n    var handled = new WeakMap();\r\n    var withBearerToken = function (config, accessToken) {\r\n        config.headers[HEADER_AUTHORIZATION] = 'Bearer ' + accessToken;\r\n        return config;\r\n    };\r\n    axios.interceptors.request.use(function (config) {\r\n        if ((filter && !filter(config)) || config.headers[HEADER_AUTHORIZATION]) {\r\n            return config;\r\n        }\r\n        return acquireToken(function (accessToken, retryable) {\r\n            handled.set(config, retryable);\r\n            return accessToken ? withBearerToken(config, accessToken) : config;\r\n        });\r\n    });\r\n    axios.interceptors.response.use(undefined, function (error) {\r\n        error = error || {};\r\n        return retryOrEnd(acquireToken, error.response, handled.get(error.config), function (accessToken) {\r\n            return axios.create()(withBearerToken(error.config, accessToken));\r\n        }, function () {\r\n            return reject(error);\r\n        });\r\n    });\r\n    return axios;\r\n}\r\n\r\nexport function createFetchMiddleware(app, filter) {\r\n    return fetchMiddleware.bind(0, app.acquireToken, filter);\r\n}\r\n\r\nexport function createAxiosMiddleware(app, filter) {\r\n    return axiosMiddleware.bind(0, app.acquireToken, filter);\r\n}\r\n","import lib from \"brew-js\";\r\nconst errorCode = lib.ErrorCode;\r\nconst { apiError } = errorCode;\r\nexport { apiError };","import { defineHiddenProperty, each, errorWithCode, extend, is } from \"zeta-dom/util\";\r\nimport { combinePath } from \"brew-js/util/path\";\r\nimport * as BrewError from \"brew-js/errorCode\";\r\n\r\nfunction getOptionsWithBody(method, body, options) {\r\n    options = options || {};\r\n    return extend({}, options, {\r\n        method: method,\r\n        body: JSON.stringify(body),\r\n        headers: extend({}, options.headers, {\r\n            'content-type': 'application/json'\r\n        })\r\n    });\r\n}\r\n\r\nfunction fetchJSON(request, next) {\r\n    request.headers.set('accept', 'application/json');\r\n    return (next || fetch)(request).then(function (response) {\r\n        return response.json().then(function (data) {\r\n            if (response.ok) {\r\n                return data;\r\n            }\r\n            throw errorWithCode(BrewError.apiError, '', { data });\r\n        }, function (e) {\r\n            if (response.ok) {\r\n                // assume empty for non-JSON response with 2xx status\r\n                return null;\r\n            }\r\n            throw errorWithCode(BrewError.apiError, '', { error: e });\r\n        });\r\n    });\r\n}\r\n\r\nfunction JSONClient(baseUrl, middleware) {\r\n    middleware = middleware || function (request, next) {\r\n        return next(request);\r\n    };\r\n    this.baseUrl = baseUrl;\r\n    this.request = function (request, options) {\r\n        request = is(request, Request) || new Request(combinePath(baseUrl, request), options);\r\n        return middleware(request, fetchJSON);\r\n    };\r\n}\r\n\r\neach('get post put patch delete', function (i, v) {\r\n    var method = v.toUpperCase();\r\n    defineHiddenProperty(JSONClient.prototype, v, function (path, body, options) {\r\n        return this.request(path, v === 'get' ? body : getOptionsWithBody(method, body, options));\r\n    });\r\n});\r\n\r\nexport default JSONClient;\r\n","import Auth from \"./extension.js\";\r\nimport * as AuthError from \"./errorCode.js\";\r\nimport AuthProvider from \"./provider.js\";\r\n\r\nexport default Auth;\r\nexport * from \"./middleware.js\";\r\nexport * from \"./util.js\";\r\n\r\nexport {\r\n    AuthError,\r\n    AuthProvider\r\n}\r\n","import Auth from \"./index.js\";\r\nimport * as methods from \"./index.js\";\r\n\r\nObject.assign(Auth, methods);\r\nexport default Auth;\r\n"],"names":["root","factory","exports","module","require","define","amd","self","__WEBPACK_EXTERNAL_MODULE__760__","__WEBPACK_EXTERNAL_MODULE__231__","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","d","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","addExtension","lib","combinePath","_lib$util","catchAsync","defineHiddenProperty","defineObservableProperty","each","errorWithCode","exclude","extend","is","isFunction","makeArray","makeAsync","mapRemove","pick","pipe","reject","resolve","resolveAll","throws","reportError","loggedIn","noProvider","invalidCredential","CACHE_KEY","app","options","currentProvider","currentResult","setUser","providers","provider","providerParams","interaction","contexts","Map","redirectUri","location","origin","toHref","sessionCache","cache","initProvider","context","revokeSession","accountId","emit","handleLogout","set","init","e","filterByProp","arr","filter","v","findProvider","params","matched","authType","providerType","loginHint","then","next","index","isHandleable","setSessionState","returnPath","popSessionState","state","navigate","handleLogin","result","data","account","resolveUser","user","error","callProvider","method","callback","promise","resolveAuthProvider","acquireToken","force","expiresOn","Date","now","accessToken","refresh","login","AuthError","postLoginPath","path","bind","logout","postLogoutPath","singleLogout","beforeInit","map","results","indexOf","findIndex","from","client","storage","window","localStorage","storageKey","storageKeyID","setCurrentData","JSON","stringify","storageArea","oldValue","cached","parse","getCachedData","HEADER_AUTHORIZATION","retryOrEnd","response","retryable","onError","status","fetchMiddleware","request","Request","fetch","headers","has","execute","req","clone","axiosMiddleware","axios","handled","WeakMap","withBearerToken","config","interceptors","use","create","createFetchMiddleware","createAxiosMiddleware","apiError","fetchJSON","json","ok","BrewError","JSONClient","baseUrl","middleware","this","i","toUpperCase","body","getOptionsWithBody","assign","Auth","methods"],"sourceRoot":""}