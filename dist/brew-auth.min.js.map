{"version":3,"file":"brew-auth.min.js","mappings":"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","sources":["webpack://brew-extension-auth/webpack/universalModuleDefinition","webpack://brew-extension-auth/external umd {\"commonjs\":\"zeta-dom\",\"commonjs2\":\"zeta-dom\",\"amd\":\"zeta-dom\",\"root\":\"zeta\"}","webpack://brew-extension-auth/external umd {\"commonjs\":\"brew-js\",\"commonjs2\":\"brew-js\",\"amd\":\"brew-js\",\"root\":\"brew\"}","webpack://brew-extension-auth/webpack/bootstrap","webpack://brew-extension-auth/webpack/runtime/define property getters","webpack://brew-extension-auth/webpack/runtime/hasOwnProperty shorthand","webpack://brew-extension-auth/webpack/runtime/make namespace object","webpack://brew-extension-auth/../brew-extension-auth|umd|C:/brew-js/app.js","webpack://brew-extension-auth/../brew-extension-auth|umd|C:/brew-js/util/path.js","webpack://brew-extension-auth/../brew-extension-auth|umd|C:/zeta-dom/util.js","webpack://brew-extension-auth/../brew-extension-auth|umd|C:/zeta-dom/dom.js","webpack://brew-extension-auth/./src/errorCode.js","webpack://brew-extension-auth/./src/extension.js","webpack://brew-extension-auth/../brew-extension-auth|umd|C:/zeta-dom/domUtil.js","webpack://brew-extension-auth/./src/provider.js","webpack://brew-extension-auth/./src/middleware.js","webpack://brew-extension-auth/../brew-extension-auth|umd|C:/brew-js/util/fetch.js","webpack://brew-extension-auth/./src/util/JSONClient.js","webpack://brew-extension-auth/./src/index.js","webpack://brew-extension-auth/./src/entry.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"brew-js\"), require(\"zeta-dom\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"@misonou/brew-extension-auth\", [\"brew-js\", \"zeta-dom\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"@misonou/brew-extension-auth\"] = factory(require(\"brew-js\"), require(\"zeta-dom\"));\n\telse\n\t\troot[\"brew\"] = root[\"brew\"] || {}, root[\"brew\"][\"Auth\"] = factory(root[\"brew\"], root[\"zeta\"]);\n})(self, function(__WEBPACK_EXTERNAL_MODULE__760__, __WEBPACK_EXTERNAL_MODULE__231__) {\nreturn ","module.exports = __WEBPACK_EXTERNAL_MODULE__231__;","module.exports = __WEBPACK_EXTERNAL_MODULE__760__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import lib from \"brew-js\";\r\nconst { addExtension } = lib;\r\nexport { addExtension };","import lib from \"brew-js\";\r\nconst { combinePath } = lib;\r\nexport { combinePath };","import lib from \"zeta-dom\";\r\nconst { catchAsync, defineHiddenProperty, defineObservableProperty, each, errorWithCode, exclude, extend, is, isErrorWithCode, isFunction, makeArray, makeAsync, mapRemove, noop, pick, pipe, reject, resolve, resolveAll, throws } = lib.util;\r\nexport { catchAsync, defineHiddenProperty, defineObservableProperty, each, errorWithCode, exclude, extend, is, isErrorWithCode, isFunction, makeArray, makeAsync, mapRemove, noop, pick, pipe, reject, resolve, resolveAll, throws };","import lib from \"zeta-dom\";\r\nconst { reportError } = lib.dom;\r\nexport { reportError };","export const loggedIn = 'brew/auth-logged-in';\r\nexport const noProvider = 'brew/auth-no-provider';\r\nexport const invalidCredential = 'brew/auth-invalid-credential';\r\n","import { addExtension } from \"brew-js/app\";\r\nimport { combinePath } from \"brew-js/util/path\";\r\nimport { catchAsync, defineObservableProperty, errorWithCode, extend, isErrorWithCode, isFunction, makeArray, makeAsync, mapRemove, pick, pipe, reject, resolve, resolveAll, throws } from \"zeta-dom/util\";\r\nimport { reportError } from \"zeta-dom/dom\";\r\nimport * as AuthError from \"./errorCode.js\";\r\n\r\nconst CACHE_KEY = 'brew.auth';\r\n\r\nexport default addExtension('auth', ['router'], function (app, options) {\r\n    var setUser = defineObservableProperty(app, 'user', null, true);\r\n    var providers = makeArray(options.providers || options.provider);\r\n    var providerParams = {\r\n        interaction: options.interaction || 'redirect',\r\n    };\r\n    var contexts = new Map();\r\n    var redirectUri = combinePath(location.origin, app.toHref('/'));\r\n    var sessionCache = app.cache;\r\n    var previousState = sessionCache.get(CACHE_KEY) || {};\r\n    var isNewSession = performance.navigation.type === 0;\r\n    var currentProvider;\r\n    var currentResult;\r\n\r\n    function initProvider(provider) {\r\n        var context = {\r\n            redirectUri: redirectUri,\r\n            revokeSession: function (accountId) {\r\n                if (currentProvider === provider && (!accountId || currentResult.accountId === accountId)) {\r\n                    currentProvider = null;\r\n                    if (!app.emit('sessionEnded')) {\r\n                        handleLogout();\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        contexts.set(provider, context);\r\n        return makeAsync(provider.init).call(provider, context).then(function () {\r\n            if (isNewSession && previousState.provider === provider.key && previousState.returnPath) {\r\n                return provider.handleLoginRedirect(context);\r\n            }\r\n        }).then(function (result) {\r\n            return result || provider.getActiveAccount(context);\r\n        }).catch(function (e) {\r\n            if (!isErrorWithCode(e, AuthError.invalidCredential)) {\r\n                reportError(e);\r\n            }\r\n        });\r\n    }\r\n\r\n    function filterByProp(arr, key, value) {\r\n        return value === undefined ? arr : arr.filter(function (v) {\r\n            return v[key] === value;\r\n        });\r\n    }\r\n\r\n    function findProvider(params) {\r\n        if (params.provider) {\r\n            return filterByProp(providers, 'key', params.provider)[0];\r\n        }\r\n        var matched = providers;\r\n        matched = filterByProp(matched, 'authType', params.authType);\r\n        matched = filterByProp(matched, 'providerType', params.providerType);\r\n        if (params.loginHint) {\r\n            return resolve(0).then(function next(index) {\r\n                var provider = matched[index];\r\n                return provider && resolve(provider.isHandleable(params.loginHint)).then(function (v) {\r\n                    return v ? provider : next(index + 1);\r\n                });\r\n            });\r\n        }\r\n        if (!matched[1]) {\r\n            return matched[0];\r\n        }\r\n    }\r\n\r\n    function setSessionState(provider, returnPath) {\r\n        sessionCache.set(CACHE_KEY, { provider, returnPath });\r\n    }\r\n\r\n    function popSessionState(provider, accountId) {\r\n        var state = mapRemove(sessionCache, CACHE_KEY) || {};\r\n        if (state.provider === provider && state.returnPath) {\r\n            catchAsync(app.navigate(state.returnPath));\r\n        }\r\n        if (provider) {\r\n            sessionCache.set(CACHE_KEY, { provider, accountId });\r\n        }\r\n    }\r\n\r\n    function handleLogin(provider, result) {\r\n        var resumed = previousState.provider === provider.key && previousState.accountId === result.accountId;\r\n        var data = {\r\n            provider: provider.key,\r\n            providerType: provider.providerType,\r\n            account: result.account\r\n        };\r\n        currentProvider = provider;\r\n        currentResult = result;\r\n        return (options.resolveUser ? makeAsync(options.resolveUser)(data) : resolve(data.account)).then(function (user) {\r\n            setUser(user);\r\n            popSessionState(provider.key, result.accountId);\r\n            app.emit('login', {\r\n                user: user,\r\n                sessionResumed: resumed,\r\n                sessionChanged: !resumed && !!previousState.accountId\r\n            });\r\n            previousState = {};\r\n        }, function (error) {\r\n            handleLogout();\r\n            throw error;\r\n        });\r\n    }\r\n\r\n    function handleLogout() {\r\n        var user = app.user;\r\n        currentProvider = null;\r\n        currentResult = null;\r\n        setUser(null);\r\n        popSessionState('');\r\n        if (user || previousState.accountId) {\r\n            app.emit('logout', { user });\r\n        }\r\n        previousState = {};\r\n    }\r\n\r\n    function callProvider(provider, method, params, callback) {\r\n        var promise = makeAsync(provider[method]).call(provider, extend({}, providerParams, params), contexts.get(provider));\r\n        promise.catch(function () {\r\n            sessionCache.delete(CACHE_KEY);\r\n        });\r\n        return promise.then(callback);\r\n    }\r\n\r\n    app.define({\r\n        resolveAuthProvider: function (params) {\r\n            return resolve(findProvider(params)).then(function (provider) {\r\n                return provider ? pick(provider, ['key', 'authType', 'providerType']) : null;\r\n            });\r\n        },\r\n        acquireToken: function (callback) {\r\n            var provider = currentProvider;\r\n            var result = currentResult;\r\n            var force = callback === true;\r\n            callback = isFunction(callback) || resolve;\r\n            if (!provider) {\r\n                return callback(null, false);\r\n            }\r\n            if (!force && currentResult.expiresOn > Date.now()) {\r\n                return callback(currentResult.accessToken, true);\r\n            }\r\n            return provider.refresh(currentResult, contexts.get(provider)).then(function (result) {\r\n                if (currentProvider === provider) {\r\n                    currentResult = result;\r\n                }\r\n                return callback(result.accessToken, false);\r\n            }, function (error) {\r\n                return force ? throws(error) : callback(result.accessToken, false);\r\n            });\r\n        },\r\n        login: function (params) {\r\n            if (currentProvider) {\r\n                return reject(errorWithCode(AuthError.loggedIn));\r\n            }\r\n            params = params || {};\r\n            return resolve(findProvider(params)).then(function (provider) {\r\n                if (!provider) {\r\n                    throw errorWithCode(AuthError.noProvider);\r\n                }\r\n                setSessionState(provider.key, params.returnPath || options.postLoginPath || app.path);\r\n                return callProvider(provider, 'login', pick(params, ['loginHint', 'password']), handleLogin.bind(0, provider));\r\n            });\r\n        },\r\n        logout: function (params) {\r\n            if (!currentProvider) {\r\n                return resolve(handleLogout());\r\n            }\r\n            params = params || {};\r\n            setSessionState('', params.returnPath || options.postLogoutPath || app.path);\r\n            return callProvider(currentProvider, 'logout', {\r\n                accountId: currentResult.accountId,\r\n                singleLogout: params.singleLogout\r\n            }, handleLogout);\r\n        }\r\n    });\r\n\r\n    app.beforeInit(function () {\r\n        return resolveAll(providers.map(initProvider), function (results) {\r\n            var index = providers.indexOf(findProvider(previousState));\r\n            if (!results[index]) {\r\n                index = results.findIndex(pipe);\r\n            }\r\n            return index >= 0 ? handleLogin(providers[index], results[index]).catch(reportError) : handleLogout();\r\n        });\r\n    });\r\n});\r\n","import lib from \"zeta-dom\";\r\nconst { bind } = lib.util;\r\nexport { bind };","import { bind } from \"zeta-dom/domUtil\";\r\nimport { exclude, noop, resolve } from \"zeta-dom/util\";\r\n\r\nconst AuthProvider = {\r\n    from: function (key, client) {\r\n        var storage = window.localStorage;\r\n        var storageKey = 'brew.auth.' + key;\r\n        var storageKeyID = storageKey + '.id';\r\n\r\n        function getCachedData() {\r\n            try {\r\n                return JSON.parse(storage[storageKey]);\r\n            } catch (e) { }\r\n        }\r\n\r\n        function setCurrentData(data) {\r\n            if (data) {\r\n                storage[storageKey] = JSON.stringify(exclude(data, ['account']));\r\n                storage[storageKeyID] = data.accountId;\r\n            } else {\r\n                delete storage[storageKey];\r\n                delete storage[storageKeyID];\r\n            }\r\n            return data;\r\n        }\r\n\r\n        return {\r\n            key: key,\r\n            authType: client.authType,\r\n            providerType: client.providerType,\r\n            init: function (context) {\r\n                bind(window, 'storage', function (e) {\r\n                    if (e.storageArea === storage && ((e.key === storageKeyID && e.oldValue) || e.key === null)) {\r\n                        context.revokeSession(e.oldValue);\r\n                    }\r\n                });\r\n                return (client.init || noop).call(client, context);\r\n            },\r\n            getActiveAccount: function (context) {\r\n                var cached = getCachedData();\r\n                return cached && client.refresh(cached, context).then(setCurrentData);\r\n            },\r\n            handleLoginRedirect: function (context) {\r\n                return resolve((client.handleLoginRedirect || noop).call(client, context)).then(setCurrentData);\r\n            },\r\n            login: function (params, context) {\r\n                return client.login(params, context).then(setCurrentData);\r\n            },\r\n            logout: function (params, context) {\r\n                return client.logout(params, context).then(setCurrentData.bind(0, undefined));\r\n            },\r\n            refresh: function (cached, context) {\r\n                return client.refresh(cached, context).then(setCurrentData);\r\n            },\r\n            isHandleable: function (loginHint) {\r\n                return client.isHandleable(loginHint);\r\n            }\r\n        };\r\n    }\r\n};\r\nexport default AuthProvider;\r\n","import { is, isFunction, reject } from \"zeta-dom/util\";\r\n\r\nconst HEADER_AUTHORIZATION = 'authorization';\r\n\r\nfunction retryOrEnd(acquireToken, response, retryable, callback, onError) {\r\n    return retryable && response && response.status === 401 ? acquireToken(true).then(callback, onError) : onError();\r\n}\r\n\r\nfunction fetchMiddleware(acquireToken, filter, request, next) {\r\n    if (!is(request, Request) || (next && !isFunction(next))) {\r\n        return fetchMiddleware(acquireToken, filter, new Request(request, next));\r\n    }\r\n    next = next || window.fetch;\r\n    if ((filter && !filter(request)) || request.headers.has(HEADER_AUTHORIZATION)) {\r\n        return next(request);\r\n    }\r\n    return acquireToken(function execute(accessToken, retryable) {\r\n        var req = request;\r\n        if (accessToken) {\r\n            req = req.clone();\r\n            req.headers.set(HEADER_AUTHORIZATION, 'Bearer ' + accessToken);\r\n        }\r\n        return next(req).then(function (response) {\r\n            return retryOrEnd(acquireToken, response, retryable, execute, function () {\r\n                return response;\r\n            });\r\n        });\r\n    });\r\n}\r\n\r\nfunction axiosMiddleware(acquireToken, filter, axios) {\r\n    var handled = new WeakMap();\r\n    var withBearerToken = function (config, accessToken) {\r\n        config.headers[HEADER_AUTHORIZATION] = 'Bearer ' + accessToken;\r\n        return config;\r\n    };\r\n    axios.interceptors.request.use(function (config) {\r\n        if ((filter && !filter(config)) || config.headers[HEADER_AUTHORIZATION]) {\r\n            return config;\r\n        }\r\n        return acquireToken(function (accessToken, retryable) {\r\n            handled.set(config, retryable);\r\n            return accessToken ? withBearerToken(config, accessToken) : config;\r\n        });\r\n    });\r\n    axios.interceptors.response.use(undefined, function (error) {\r\n        error = error || {};\r\n        return retryOrEnd(acquireToken, error.response, handled.get(error.config), function (accessToken) {\r\n            return axios.create()(withBearerToken(error.config, accessToken));\r\n        }, function () {\r\n            return reject(error);\r\n        });\r\n    });\r\n    return axios;\r\n}\r\n\r\nexport function createFetchMiddleware(app, filter) {\r\n    return fetchMiddleware.bind(0, app.acquireToken, filter);\r\n}\r\n\r\nexport function createAxiosMiddleware(app, filter) {\r\n    return axiosMiddleware.bind(0, app.acquireToken, filter);\r\n}\r\n","import lib from \"brew-js\";\r\nconst { createApiClient } = lib;\r\nexport { createApiClient };","import { defineHiddenProperty, each, errorWithCode } from \"zeta-dom/util\";\r\nimport { createApiClient } from \"brew-js/util/fetch\";\r\nimport * as AuthErrorCode from \"../errorCode.js\";\r\n\r\nfunction JSONClient(baseUrl, middleware) {\r\n    this.baseUrl = baseUrl;\r\n    this.request = createApiClient(baseUrl, {\r\n        request: middleware,\r\n        error: function (error) {\r\n            if (error.status === 401) {\r\n                throw errorWithCode(AuthErrorCode.invalidCredential);\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\neach('get post put patch delete', function (i, v) {\r\n    defineHiddenProperty(JSONClient.prototype, v, function (path, body, options) {\r\n        return this.request[v](path, body, options);\r\n    });\r\n});\r\n\r\nexport default JSONClient;\r\n","import Auth from \"./extension.js\";\r\nimport * as AuthError from \"./errorCode.js\";\r\nimport AuthProvider from \"./provider.js\";\r\n\r\nexport default Auth;\r\nexport * from \"./middleware.js\";\r\nexport * from \"./util.js\";\r\n\r\nexport {\r\n    AuthError,\r\n    AuthProvider\r\n}\r\n","import Auth from \"./index.js\";\r\nimport * as methods from \"./index.js\";\r\n\r\nObject.assign(Auth, methods);\r\nexport default Auth;\r\n"],"names":["root","factory","exports","module","require","define","amd","self","__WEBPACK_EXTERNAL_MODULE__760__","__WEBPACK_EXTERNAL_MODULE__231__","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","d","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","addExtension","lib","combinePath","_lib$util","catchAsync","defineHiddenProperty","defineObservableProperty","each","errorWithCode","exclude","extend","is","isErrorWithCode","isFunction","makeArray","makeAsync","mapRemove","noop","pick","pipe","reject","resolve","resolveAll","throws","reportError","loggedIn","noProvider","invalidCredential","CACHE_KEY","app","options","currentProvider","currentResult","setUser","providers","provider","providerParams","interaction","contexts","Map","redirectUri","location","origin","toHref","sessionCache","cache","previousState","isNewSession","performance","navigation","type","initProvider","context","revokeSession","accountId","emit","handleLogout","set","init","then","returnPath","handleLoginRedirect","result","getActiveAccount","e","AuthError","filterByProp","arr","filter","v","findProvider","params","matched","authType","providerType","loginHint","next","index","isHandleable","setSessionState","popSessionState","state","navigate","handleLogin","resumed","data","account","resolveUser","user","sessionResumed","sessionChanged","error","callProvider","method","callback","promise","resolveAuthProvider","acquireToken","force","expiresOn","Date","now","accessToken","refresh","login","postLoginPath","path","bind","logout","postLogoutPath","singleLogout","beforeInit","map","results","indexOf","findIndex","from","client","storage","window","localStorage","storageKey","storageKeyID","setCurrentData","JSON","stringify","storageArea","oldValue","cached","parse","getCachedData","HEADER_AUTHORIZATION","retryOrEnd","response","retryable","onError","status","fetchMiddleware","request","Request","fetch","headers","has","execute","req","clone","axiosMiddleware","axios","handled","WeakMap","withBearerToken","config","interceptors","use","create","createFetchMiddleware","createAxiosMiddleware","createApiClient","JSONClient","baseUrl","middleware","this","AuthErrorCode","i","body","assign","Auth","methods"],"ignoreList":[],"sourceRoot":""}