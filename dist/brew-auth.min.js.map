{"version":3,"file":"brew-auth.min.js","mappings":"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","sources":["webpack://brew-extension-auth/webpack/universalModuleDefinition","webpack://brew-extension-auth/external umd {\"commonjs\":\"brew-js\",\"commonjs2\":\"brew-js\",\"amd\":\"brew-js\",\"root\":\"brew\"}","webpack://brew-extension-auth/external umd {\"commonjs\":\"zeta-dom\",\"commonjs2\":\"zeta-dom\",\"amd\":\"zeta-dom\",\"root\":\"zeta\"}","webpack://brew-extension-auth/webpack/bootstrap","webpack://brew-extension-auth/webpack/runtime/define property getters","webpack://brew-extension-auth/webpack/runtime/hasOwnProperty shorthand","webpack://brew-extension-auth/webpack/runtime/make namespace object","webpack://brew-extension-auth/../brew-extension-auth|umd|C:/brew-js/app.js","webpack://brew-extension-auth/../brew-extension-auth|umd|C:/brew-js/util/path.js","webpack://brew-extension-auth/../brew-extension-auth|umd|C:/zeta-dom/util.js","webpack://brew-extension-auth/../brew-extension-auth|umd|C:/zeta-dom/dom.js","webpack://brew-extension-auth/./src/errorCode.js","webpack://brew-extension-auth/./src/extension.js","webpack://brew-extension-auth/../brew-extension-auth|umd|C:/zeta-dom/domUtil.js","webpack://brew-extension-auth/./src/provider.js","webpack://brew-extension-auth/./src/middleware.js","webpack://brew-extension-auth/../brew-extension-auth|umd|C:/brew-js/errorCode.js","webpack://brew-extension-auth/./src/util/JSONClient.js","webpack://brew-extension-auth/./src/index.js","webpack://brew-extension-auth/./src/entry.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"brew-js\"), require(\"zeta-dom\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"@misonou/brew-extension-auth\", [\"brew-js\", \"zeta-dom\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Auth\"] = factory(require(\"brew-js\"), require(\"zeta-dom\"));\n\telse\n\t\troot[\"brew\"] = root[\"brew\"] || {}, root[\"brew\"][\"Auth\"] = factory(root[\"brew\"], root[\"zeta\"]);\n})(self, function(__WEBPACK_EXTERNAL_MODULE__760__, __WEBPACK_EXTERNAL_MODULE__231__) {\nreturn ","module.exports = __WEBPACK_EXTERNAL_MODULE__760__;","module.exports = __WEBPACK_EXTERNAL_MODULE__231__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import lib from \"brew-js\";\r\nconst { addExtension } = lib;\r\nexport { addExtension };","import lib from \"brew-js\";\r\nconst { combinePath } = lib;\r\nexport { combinePath };","import lib from \"zeta-dom\";\r\nconst { catchAsync, defineHiddenProperty, defineObservableProperty, each, errorWithCode, exclude, extend, is, isFunction, makeArray, makeAsync, mapRemove, pick, pipe, reject, resolve, resolveAll, throws } = lib.util;\r\nexport { catchAsync, defineHiddenProperty, defineObservableProperty, each, errorWithCode, exclude, extend, is, isFunction, makeArray, makeAsync, mapRemove, pick, pipe, reject, resolve, resolveAll, throws };","import lib from \"zeta-dom\";\r\nconst { reportError } = lib.dom;\r\nexport { reportError };","export const loggedIn = 'brew/auth-logged-in';\r\nexport const noProvider = 'brew/auth-no-provider';\r\nexport const invalidCredential = 'brew/auth-invalid-credential';\r\n","import { addExtension } from \"brew-js/app\";\r\nimport { combinePath } from \"brew-js/util/path\";\r\nimport { catchAsync, defineObservableProperty, errorWithCode, extend, isFunction, makeArray, makeAsync, mapRemove, pick, pipe, reject, resolve, resolveAll, throws } from \"zeta-dom/util\";\r\nimport { reportError } from \"zeta-dom/dom\";\r\nimport * as AuthError from \"./errorCode.js\";\r\n\r\nconst CACHE_KEY = 'brew.auth';\r\n\r\nexport default addExtension('auth', ['router'], function (app, options) {\r\n    var setUser = defineObservableProperty(app, 'user', null, true);\r\n    var providers = makeArray(options.providers);\r\n    var providerParams = {\r\n        interaction: options.interaction || 'redirect',\r\n    };\r\n    var contexts = new Map();\r\n    var redirectUri = combinePath(location.origin, app.toHref('/'));\r\n    var sessionCache = app.cache;\r\n    var currentProvider;\r\n    var currentResult;\r\n\r\n    function initProvider(provider) {\r\n        var context = {\r\n            redirectUri: redirectUri,\r\n            revokeSession: function (accountId) {\r\n                if (currentProvider === provider && (!accountId || currentResult.accountId === accountId)) {\r\n                    currentProvider = null;\r\n                    if (!app.emit('sessionEnded')) {\r\n                        handleLogout();\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        contexts.set(provider, context);\r\n        return resolve(provider.init(context)).catch(function (e) {\r\n            reportError(e);\r\n        });\r\n    }\r\n\r\n    function findProvider(params) {\r\n        if (params.provider) {\r\n            return providers.find(function (v) {\r\n                return v.key === params.provider;\r\n            });\r\n        }\r\n        if (params.loginHint) {\r\n            return resolve(0).then(function next(index) {\r\n                var provider = providers[index];\r\n                return provider && resolve(provider.isHandleable(params.loginHint)).then(function (v) {\r\n                    return v ? provider : next(index + 1);\r\n                });\r\n            });\r\n        }\r\n        if (!providers[1]) {\r\n            return providers[0];\r\n        }\r\n    }\r\n\r\n    function setSessionState(provider, returnPath) {\r\n        sessionCache.set(CACHE_KEY, { provider, returnPath });\r\n    }\r\n\r\n    function popSessionState(provider) {\r\n        var state = mapRemove(sessionCache, CACHE_KEY) || {};\r\n        if (state.provider === provider) {\r\n            catchAsync(app.navigate(state.returnPath));\r\n        }\r\n    }\r\n\r\n    function handleLogin(provider, result) {\r\n        var data = {\r\n            provider: provider.key,\r\n            providerType: provider.providerType,\r\n            account: result.account\r\n        };\r\n        currentProvider = provider;\r\n        currentResult = result;\r\n        return makeAsync(options.resolveUser)(data).then(function (user) {\r\n            setUser(user);\r\n            popSessionState(provider.key);\r\n            app.emit('login', { user });\r\n        }, function (error) {\r\n            handleLogout();\r\n            throw error;\r\n        });\r\n    }\r\n\r\n    function handleLogout() {\r\n        var user = app.user;\r\n        currentProvider = null;\r\n        currentResult = null;\r\n        setUser(null);\r\n        popSessionState('');\r\n        if (user) {\r\n            app.emit('logout', { user });\r\n        }\r\n    }\r\n\r\n    function callProvider(provider, method, params, callback) {\r\n        var promise = makeAsync(provider[method]).call(provider, extend({}, providerParams, params), contexts.get(provider));\r\n        promise.catch(function () {\r\n            sessionCache.delete(CACHE_KEY);\r\n        });\r\n        return promise.then(callback);\r\n    }\r\n\r\n    app.define({\r\n        resolveAuthProvider: function (params) {\r\n            return resolve(findProvider(params)).then(function (provider) {\r\n                return provider ? pick(provider, ['key', 'authType', 'providerType']) : null;\r\n            });\r\n        },\r\n        acquireToken: function (callback) {\r\n            var provider = currentProvider;\r\n            var result = currentResult;\r\n            var force = callback === true;\r\n            callback = isFunction(callback) || resolve;\r\n            if (!provider) {\r\n                return callback(null, false);\r\n            }\r\n            if (!force && currentResult.expiresOn > Date.now()) {\r\n                return callback(currentResult.accessToken, true);\r\n            }\r\n            return provider.refresh(currentResult, contexts.get(provider)).then(function (result) {\r\n                if (currentProvider === provider) {\r\n                    currentResult = result;\r\n                }\r\n                return callback(result.accessToken, false);\r\n            }, function (error) {\r\n                return force ? throws(error) : callback(result.accessToken, false);\r\n            });\r\n        },\r\n        login: function (params) {\r\n            if (currentProvider) {\r\n                return reject(errorWithCode(AuthError.loggedIn));\r\n            }\r\n            params = params || {};\r\n            return resolve(findProvider(params)).then(function (provider) {\r\n                if (!provider) {\r\n                    throw errorWithCode(AuthError.noProvider);\r\n                }\r\n                setSessionState(provider.key, params.returnPath || options.postLoginPath || app.path);\r\n                return callProvider(provider, 'login', pick(params, ['loginHint', 'password']), handleLogin.bind(0, provider));\r\n            });\r\n        },\r\n        logout: function (params) {\r\n            if (!currentProvider) {\r\n                return resolve(handleLogout());\r\n            }\r\n            params = params || {};\r\n            setSessionState('', params.returnPath || options.postLogoutPath || app.path);\r\n            return callProvider(currentProvider, 'logout', {\r\n                accountId: currentResult.accountId,\r\n                singleLogout: params.singleLogout\r\n            }, handleLogout);\r\n        }\r\n    });\r\n\r\n    app.beforeInit(function () {\r\n        return resolveAll(providers.map(initProvider), function (results) {\r\n            var index = providers.indexOf(findProvider(sessionCache.get(CACHE_KEY) || {}));\r\n            if (!results[index]) {\r\n                index = results.findIndex(pipe);\r\n            }\r\n            return index >= 0 ? handleLogin(providers[index], results[index]) : handleLogout();\r\n        });\r\n    });\r\n});\r\n","import lib from \"zeta-dom\";\r\nconst { bind } = lib.util;\r\nexport { bind };","import { bind } from \"zeta-dom/domUtil\";\r\nimport { exclude } from \"zeta-dom/util\";\r\n\r\nconst AuthProvider = {\r\n    from: function (key, client) {\r\n        var storage = window.localStorage;\r\n        var storageKey = 'brew.auth.' + key;\r\n        var storageKeyID = storageKey + '.id';\r\n\r\n        function getCachedData() {\r\n            try {\r\n                return JSON.parse(storage[storageKey]);\r\n            } catch (e) { }\r\n        }\r\n\r\n        function setCurrentData(data) {\r\n            if (data) {\r\n                storage[storageKey] = JSON.stringify(exclude(data, ['account']));\r\n                storage[storageKeyID] = data.accountId;\r\n            } else {\r\n                delete storage[storageKey];\r\n                delete storage[storageKeyID];\r\n            }\r\n            return data;\r\n        }\r\n\r\n        return {\r\n            key: key,\r\n            authType: client.authType,\r\n            providerType: client.providerType,\r\n            init: function (context) {\r\n                bind(window, 'storage', function (e) {\r\n                    if (e.storageArea === storage && ((e.key === storageKeyID && e.oldValue) || e.key === null)) {\r\n                        context.revokeSession(e.oldValue);\r\n                    }\r\n                });\r\n                var cached = getCachedData();\r\n                return cached && client.refresh(cached).then(setCurrentData);\r\n            },\r\n            login: function (params) {\r\n                return client.login(params).then(setCurrentData);\r\n            },\r\n            logout: function (params) {\r\n                return client.logout(params).then(setCurrentData.bind(0, undefined));\r\n            },\r\n            refresh: function (cached) {\r\n                return client.refresh(cached).then(setCurrentData);\r\n            },\r\n            isHandleable: function (loginHint) {\r\n                return client.isHandleable(loginHint);\r\n            }\r\n        };\r\n    }\r\n};\r\nexport default AuthProvider;\r\n","import { is, isFunction, mapRemove, reject } from \"zeta-dom/util\";\r\n\r\nfunction retryOrEnd(acquireToken, response, retryable, callback, onError) {\r\n    return retryable && response && response.status === 401 ? acquireToken(true).then(callback, onError) : onError();\r\n}\r\n\r\nfunction fetchMiddleware(acquireToken, request, next) {\r\n    if (!is(request, Request) || (next && !isFunction(next))) {\r\n        return fetchMiddleware(acquireToken, new Request(request, next));\r\n    }\r\n    next = next || window.fetch;\r\n    return acquireToken(function execute(accessToken, retryable) {\r\n        var req = request;\r\n        if (accessToken) {\r\n            req = req.clone();\r\n            req.headers.set('authorization', 'Bearer ' + accessToken);\r\n        }\r\n        return next(req).then(function (response) {\r\n            return retryOrEnd(acquireToken, response, retryable, execute, function () {\r\n                return response;\r\n            });\r\n        });\r\n    });\r\n}\r\n\r\nfunction axiosMiddleware(acquireToken, axios) {\r\n    var handled = new WeakMap();\r\n    var withBearerToken = function (config, accessToken) {\r\n        config.headers.authorization = 'Bearer ' + accessToken;\r\n        return config;\r\n    };\r\n    axios.interceptors.request.use(function (config) {\r\n        if (mapRemove(handled, config)) {\r\n            // refreshed access token is already set in error interceptors\r\n            // flag is removed from map to avoid recursion\r\n            return config;\r\n        }\r\n        return acquireToken(function (accessToken, retryable) {\r\n            handled.set(config, retryable);\r\n            return accessToken ? withBearerToken(config, accessToken) : config;\r\n        });\r\n    });\r\n    axios.interceptors.response.use(undefined, function (error) {\r\n        error = error || {};\r\n        return retryOrEnd(acquireToken, error.response, handled.get(error.config), function (accessToken) {\r\n            return axios(withBearerToken(error.config, accessToken));\r\n        }, function () {\r\n            return reject(error);\r\n        });\r\n    });\r\n    return axios;\r\n}\r\n\r\nexport function createFetchMiddleware(app) {\r\n    return fetchMiddleware.bind(0, app.acquireToken);\r\n}\r\n\r\nexport function createAxiosMiddleware(app) {\r\n    return axiosMiddleware.bind(0, app.acquireToken);\r\n}\r\n","import lib from \"brew-js\";\r\nconst errorCode = lib.ErrorCode;\r\nconst { apiError } = errorCode;\r\nexport { apiError };","import { defineHiddenProperty, each, errorWithCode, extend, is } from \"zeta-dom/util\";\r\nimport { combinePath } from \"brew-js/util/path\";\r\nimport * as BrewError from \"brew-js/errorCode\";\r\n\r\nfunction getOptionsWithBody(method, body, options) {\r\n    options = options || {};\r\n    return extend({}, options, {\r\n        method: method,\r\n        body: JSON.stringify(body),\r\n        headers: extend({}, options.headers, {\r\n            'content-type': 'application/json'\r\n        })\r\n    });\r\n}\r\n\r\nfunction fetchJSON(request, next) {\r\n    request.headers.set('accept', 'application/json');\r\n    return (next || fetch)(request).then(function (response) {\r\n        return response.json().then(function (data) {\r\n            if (response.ok) {\r\n                return data;\r\n            }\r\n            throw errorWithCode(BrewError.apiError, '', { data });\r\n        }, function (e) {\r\n            if (response.ok) {\r\n                // assume empty for non-JSON response with 2xx status\r\n                return null;\r\n            }\r\n            throw e;\r\n        });\r\n    });\r\n}\r\n\r\nfunction JSONClient(baseUrl, middleware) {\r\n    middleware = middleware || function (request, next) {\r\n        return next(request);\r\n    };\r\n    this.baseUrl = baseUrl;\r\n    this.request = function (request, options) {\r\n        request = is(request, Request) || new Request(combinePath(baseUrl, request), options);\r\n        return middleware(request, fetchJSON);\r\n    };\r\n}\r\n\r\neach('get post put patch delete', function (i, v) {\r\n    var method = v.toUpperCase();\r\n    defineHiddenProperty(JSONClient.prototype, v, function (path, body, options) {\r\n        return this.request(path, v === 'get' ? body : getOptionsWithBody(method, body, options));\r\n    });\r\n});\r\n\r\nexport default JSONClient;\r\n","import Auth from \"./extension.js\";\r\nimport * as AuthError from \"./errorCode.js\";\r\nimport AuthProvider from \"./provider.js\";\r\n\r\nexport default Auth;\r\nexport * from \"./middleware.js\";\r\nexport * from \"./util.js\";\r\n\r\nexport {\r\n    AuthError,\r\n    AuthProvider\r\n}\r\n","import Auth from \"./index.js\";\r\nimport * as methods from \"./index.js\";\r\n\r\nObject.assign(Auth, methods);\r\nexport default Auth;\r\n"],"names":["root","factory","exports","module","require","define","amd","self","__WEBPACK_EXTERNAL_MODULE__760__","__WEBPACK_EXTERNAL_MODULE__231__","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","d","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","addExtension","lib","combinePath","_lib$util","catchAsync","defineHiddenProperty","defineObservableProperty","each","errorWithCode","exclude","extend","is","isFunction","makeArray","makeAsync","mapRemove","pick","pipe","reject","resolve","resolveAll","throws","reportError","loggedIn","noProvider","invalidCredential","CACHE_KEY","app","options","currentProvider","currentResult","setUser","providers","providerParams","interaction","contexts","Map","redirectUri","location","origin","toHref","sessionCache","cache","initProvider","provider","context","revokeSession","accountId","emit","handleLogout","set","init","e","findProvider","params","find","v","loginHint","then","next","index","isHandleable","setSessionState","returnPath","popSessionState","state","navigate","handleLogin","result","data","providerType","account","resolveUser","user","error","callProvider","method","callback","promise","resolveAuthProvider","acquireToken","force","expiresOn","Date","now","accessToken","refresh","login","AuthError","postLoginPath","path","bind","logout","postLogoutPath","singleLogout","beforeInit","map","results","indexOf","findIndex","from","client","storage","window","localStorage","storageKey","storageKeyID","setCurrentData","JSON","stringify","authType","storageArea","oldValue","cached","parse","getCachedData","retryOrEnd","response","retryable","onError","status","fetchMiddleware","request","Request","fetch","execute","req","clone","headers","axiosMiddleware","axios","handled","WeakMap","withBearerToken","config","authorization","interceptors","use","createFetchMiddleware","createAxiosMiddleware","apiError","fetchJSON","json","ok","BrewError","JSONClient","baseUrl","middleware","this","i","toUpperCase","body","getOptionsWithBody","assign","Auth","methods"],"sourceRoot":""}