{"version":3,"file":"brew-auth.js","mappings":"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","sources":["webpack://brew-extension-auth/webpack/universalModuleDefinition","webpack://brew-extension-auth/external umd {\"commonjs\":\"brew-js\",\"commonjs2\":\"brew-js\",\"amd\":\"brew-js\",\"root\":\"brew\"}","webpack://brew-extension-auth/external umd {\"commonjs\":\"zeta-dom\",\"commonjs2\":\"zeta-dom\",\"amd\":\"zeta-dom\",\"root\":\"zeta\"}","webpack://brew-extension-auth/webpack/bootstrap","webpack://brew-extension-auth/webpack/runtime/define property getters","webpack://brew-extension-auth/webpack/runtime/hasOwnProperty shorthand","webpack://brew-extension-auth/webpack/runtime/make namespace object","webpack://brew-extension-auth/../brew-extension-auth|umd|C:/brew-js/app.js","webpack://brew-extension-auth/../brew-extension-auth|umd|C:/brew-js/util/path.js","webpack://brew-extension-auth/../brew-extension-auth|umd|C:/zeta-dom/util.js","webpack://brew-extension-auth/../brew-extension-auth|umd|C:/zeta-dom/dom.js","webpack://brew-extension-auth/./src/errorCode.js","webpack://brew-extension-auth/./src/extension.js","webpack://brew-extension-auth/../brew-extension-auth|umd|C:/zeta-dom/domUtil.js","webpack://brew-extension-auth/./src/provider.js","webpack://brew-extension-auth/./src/middleware.js","webpack://brew-extension-auth/../brew-extension-auth|umd|C:/brew-js/errorCode.js","webpack://brew-extension-auth/./src/util/JSONClient.js","webpack://brew-extension-auth/./src/util.js","webpack://brew-extension-auth/./src/index.js","webpack://brew-extension-auth/./src/entry.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"brew-js\"), require(\"zeta-dom\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"@misonou/brew-extension-auth\", [\"brew-js\", \"zeta-dom\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Auth\"] = factory(require(\"brew-js\"), require(\"zeta-dom\"));\n\telse\n\t\troot[\"brew\"] = root[\"brew\"] || {}, root[\"brew\"][\"Auth\"] = factory(root[\"brew\"], root[\"zeta\"]);\n})(self, function(__WEBPACK_EXTERNAL_MODULE__760__, __WEBPACK_EXTERNAL_MODULE__231__) {\nreturn ","module.exports = __WEBPACK_EXTERNAL_MODULE__760__;","module.exports = __WEBPACK_EXTERNAL_MODULE__231__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import lib from \"brew-js\";\r\nconst { addExtension } = lib;\r\nexport { addExtension };","import lib from \"brew-js\";\r\nconst { combinePath } = lib;\r\nexport { combinePath };","import lib from \"zeta-dom\";\r\nconst { catchAsync, defineHiddenProperty, defineObservableProperty, each, errorWithCode, exclude, extend, is, isErrorWithCode, isFunction, makeArray, makeAsync, mapRemove, noop, pick, pipe, reject, resolve, resolveAll, throws } = lib.util;\r\nexport { catchAsync, defineHiddenProperty, defineObservableProperty, each, errorWithCode, exclude, extend, is, isErrorWithCode, isFunction, makeArray, makeAsync, mapRemove, noop, pick, pipe, reject, resolve, resolveAll, throws };","import lib from \"zeta-dom\";\r\nconst { reportError } = lib.dom;\r\nexport { reportError };","export const loggedIn = 'brew/auth-logged-in';\r\nexport const noProvider = 'brew/auth-no-provider';\r\nexport const invalidCredential = 'brew/auth-invalid-credential';\r\n","import { addExtension } from \"brew-js/app\";\r\nimport { combinePath } from \"brew-js/util/path\";\r\nimport { catchAsync, defineObservableProperty, errorWithCode, extend, isErrorWithCode, isFunction, makeArray, makeAsync, mapRemove, pick, pipe, reject, resolve, resolveAll, throws } from \"zeta-dom/util\";\r\nimport { reportError } from \"zeta-dom/dom\";\r\nimport * as AuthError from \"./errorCode.js\";\r\n\r\nconst CACHE_KEY = 'brew.auth';\r\n\r\nexport default addExtension('auth', ['router'], function (app, options) {\r\n    var setUser = defineObservableProperty(app, 'user', null, true);\r\n    var providers = makeArray(options.providers || options.provider);\r\n    var providerParams = {\r\n        interaction: options.interaction || 'redirect',\r\n    };\r\n    var contexts = new Map();\r\n    var redirectUri = combinePath(location.origin, app.toHref('/'));\r\n    var sessionCache = app.cache;\r\n    var previousState = sessionCache.get(CACHE_KEY) || {};\r\n    var isNewSession = performance.navigation.type === 0;\r\n    var currentProvider;\r\n    var currentResult;\r\n\r\n    function initProvider(provider) {\r\n        var context = {\r\n            redirectUri: redirectUri,\r\n            revokeSession: function (accountId) {\r\n                if (currentProvider === provider && (!accountId || currentResult.accountId === accountId)) {\r\n                    currentProvider = null;\r\n                    if (!app.emit('sessionEnded')) {\r\n                        handleLogout();\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        contexts.set(provider, context);\r\n        return makeAsync(provider.init).call(provider, context).then(function () {\r\n            if (isNewSession && previousState.provider === provider.key && previousState.returnPath) {\r\n                return provider.handleLoginRedirect(context);\r\n            }\r\n        }).then(function (result) {\r\n            return result || provider.getActiveAccount(context);\r\n        }).catch(function (e) {\r\n            if (!isErrorWithCode(e, AuthError.invalidCredential)) {\r\n                reportError(e);\r\n            }\r\n        });\r\n    }\r\n\r\n    function filterByProp(arr, key, value) {\r\n        return value === undefined ? arr : arr.filter(function (v) {\r\n            return v[key] === value;\r\n        });\r\n    }\r\n\r\n    function findProvider(params) {\r\n        if (params.provider) {\r\n            return filterByProp(providers, 'key', params.provider)[0];\r\n        }\r\n        var matched = providers;\r\n        matched = filterByProp(matched, 'authType', params.authType);\r\n        matched = filterByProp(matched, 'providerType', params.providerType);\r\n        if (params.loginHint) {\r\n            return resolve(0).then(function next(index) {\r\n                var provider = matched[index];\r\n                return provider && resolve(provider.isHandleable(params.loginHint)).then(function (v) {\r\n                    return v ? provider : next(index + 1);\r\n                });\r\n            });\r\n        }\r\n        if (!matched[1]) {\r\n            return matched[0];\r\n        }\r\n    }\r\n\r\n    function setSessionState(provider, returnPath) {\r\n        sessionCache.set(CACHE_KEY, { provider, returnPath });\r\n    }\r\n\r\n    function popSessionState(provider, accountId) {\r\n        var state = mapRemove(sessionCache, CACHE_KEY) || {};\r\n        if (state.provider === provider && state.returnPath) {\r\n            catchAsync(app.navigate(state.returnPath));\r\n        }\r\n        if (provider) {\r\n            sessionCache.set(CACHE_KEY, { provider, accountId });\r\n        }\r\n    }\r\n\r\n    function handleLogin(provider, result) {\r\n        var resumed = previousState.provider === provider.key && previousState.accountId === result.accountId;\r\n        var data = {\r\n            provider: provider.key,\r\n            providerType: provider.providerType,\r\n            account: result.account\r\n        };\r\n        currentProvider = provider;\r\n        currentResult = result;\r\n        return (options.resolveUser ? makeAsync(options.resolveUser)(data) : resolve(data.account)).then(function (user) {\r\n            setUser(user);\r\n            popSessionState(provider.key, result.accountId);\r\n            app.emit('login', {\r\n                user: user,\r\n                sessionResumed: resumed,\r\n                sessionChanged: !resumed && !!previousState.accountId\r\n            });\r\n            previousState = {};\r\n        }, function (error) {\r\n            handleLogout();\r\n            throw error;\r\n        });\r\n    }\r\n\r\n    function handleLogout() {\r\n        var user = app.user;\r\n        currentProvider = null;\r\n        currentResult = null;\r\n        setUser(null);\r\n        popSessionState('');\r\n        if (user || previousState.accountId) {\r\n            app.emit('logout', { user });\r\n        }\r\n        previousState = {};\r\n    }\r\n\r\n    function callProvider(provider, method, params, callback) {\r\n        var promise = makeAsync(provider[method]).call(provider, extend({}, providerParams, params), contexts.get(provider));\r\n        promise.catch(function () {\r\n            sessionCache.delete(CACHE_KEY);\r\n        });\r\n        return promise.then(callback);\r\n    }\r\n\r\n    app.define({\r\n        resolveAuthProvider: function (params) {\r\n            return resolve(findProvider(params)).then(function (provider) {\r\n                return provider ? pick(provider, ['key', 'authType', 'providerType']) : null;\r\n            });\r\n        },\r\n        acquireToken: function (callback) {\r\n            var provider = currentProvider;\r\n            var result = currentResult;\r\n            var force = callback === true;\r\n            callback = isFunction(callback) || resolve;\r\n            if (!provider) {\r\n                return callback(null, false);\r\n            }\r\n            if (!force && currentResult.expiresOn > Date.now()) {\r\n                return callback(currentResult.accessToken, true);\r\n            }\r\n            return provider.refresh(currentResult, contexts.get(provider)).then(function (result) {\r\n                if (currentProvider === provider) {\r\n                    currentResult = result;\r\n                }\r\n                return callback(result.accessToken, false);\r\n            }, function (error) {\r\n                return force ? throws(error) : callback(result.accessToken, false);\r\n            });\r\n        },\r\n        login: function (params) {\r\n            if (currentProvider) {\r\n                return reject(errorWithCode(AuthError.loggedIn));\r\n            }\r\n            params = params || {};\r\n            return resolve(findProvider(params)).then(function (provider) {\r\n                if (!provider) {\r\n                    throw errorWithCode(AuthError.noProvider);\r\n                }\r\n                setSessionState(provider.key, params.returnPath || options.postLoginPath || app.path);\r\n                return callProvider(provider, 'login', pick(params, ['loginHint', 'password']), handleLogin.bind(0, provider));\r\n            });\r\n        },\r\n        logout: function (params) {\r\n            if (!currentProvider) {\r\n                return resolve(handleLogout());\r\n            }\r\n            params = params || {};\r\n            setSessionState('', params.returnPath || options.postLogoutPath || app.path);\r\n            return callProvider(currentProvider, 'logout', {\r\n                accountId: currentResult.accountId,\r\n                singleLogout: params.singleLogout\r\n            }, handleLogout);\r\n        }\r\n    });\r\n\r\n    app.beforeInit(function () {\r\n        return resolveAll(providers.map(initProvider), function (results) {\r\n            var index = providers.indexOf(findProvider(previousState));\r\n            if (!results[index]) {\r\n                index = results.findIndex(pipe);\r\n            }\r\n            return index >= 0 ? handleLogin(providers[index], results[index]).catch(reportError) : handleLogout();\r\n        });\r\n    });\r\n});\r\n","import lib from \"zeta-dom\";\r\nconst { bind } = lib.util;\r\nexport { bind };","import { bind } from \"zeta-dom/domUtil\";\r\nimport { exclude, noop, resolve } from \"zeta-dom/util\";\r\n\r\nconst AuthProvider = {\r\n    from: function (key, client) {\r\n        var storage = window.localStorage;\r\n        var storageKey = 'brew.auth.' + key;\r\n        var storageKeyID = storageKey + '.id';\r\n\r\n        function getCachedData() {\r\n            try {\r\n                return JSON.parse(storage[storageKey]);\r\n            } catch (e) { }\r\n        }\r\n\r\n        function setCurrentData(data) {\r\n            if (data) {\r\n                storage[storageKey] = JSON.stringify(exclude(data, ['account']));\r\n                storage[storageKeyID] = data.accountId;\r\n            } else {\r\n                delete storage[storageKey];\r\n                delete storage[storageKeyID];\r\n            }\r\n            return data;\r\n        }\r\n\r\n        return {\r\n            key: key,\r\n            authType: client.authType,\r\n            providerType: client.providerType,\r\n            init: function (context) {\r\n                bind(window, 'storage', function (e) {\r\n                    if (e.storageArea === storage && ((e.key === storageKeyID && e.oldValue) || e.key === null)) {\r\n                        context.revokeSession(e.oldValue);\r\n                    }\r\n                });\r\n                return (client.init || noop).call(client, context);\r\n            },\r\n            getActiveAccount: function (context) {\r\n                var cached = getCachedData();\r\n                return cached && client.refresh(cached, context).then(setCurrentData);\r\n            },\r\n            handleLoginRedirect: function (context) {\r\n                return resolve((client.handleLoginRedirect || noop).call(client, context)).then(setCurrentData);\r\n            },\r\n            login: function (params, context) {\r\n                return client.login(params, context).then(setCurrentData);\r\n            },\r\n            logout: function (params, context) {\r\n                return client.logout(params, context).then(setCurrentData.bind(0, undefined));\r\n            },\r\n            refresh: function (cached, context) {\r\n                return client.refresh(cached, context).then(setCurrentData);\r\n            },\r\n            isHandleable: function (loginHint) {\r\n                return client.isHandleable(loginHint);\r\n            }\r\n        };\r\n    }\r\n};\r\nexport default AuthProvider;\r\n","import { is, isFunction, reject } from \"zeta-dom/util\";\r\n\r\nconst HEADER_AUTHORIZATION = 'authorization';\r\n\r\nfunction retryOrEnd(acquireToken, response, retryable, callback, onError) {\r\n    return retryable && response && response.status === 401 ? acquireToken(true).then(callback, onError) : onError();\r\n}\r\n\r\nfunction fetchMiddleware(acquireToken, filter, request, next) {\r\n    if (!is(request, Request) || (next && !isFunction(next))) {\r\n        return fetchMiddleware(acquireToken, filter, new Request(request, next));\r\n    }\r\n    next = next || window.fetch;\r\n    if ((filter && !filter(request)) || request.headers.has(HEADER_AUTHORIZATION)) {\r\n        return next(request);\r\n    }\r\n    return acquireToken(function execute(accessToken, retryable) {\r\n        var req = request;\r\n        if (accessToken) {\r\n            req = req.clone();\r\n            req.headers.set(HEADER_AUTHORIZATION, 'Bearer ' + accessToken);\r\n        }\r\n        return next(req).then(function (response) {\r\n            return retryOrEnd(acquireToken, response, retryable, execute, function () {\r\n                return response;\r\n            });\r\n        });\r\n    });\r\n}\r\n\r\nfunction axiosMiddleware(acquireToken, filter, axios) {\r\n    var handled = new WeakMap();\r\n    var withBearerToken = function (config, accessToken) {\r\n        config.headers[HEADER_AUTHORIZATION] = 'Bearer ' + accessToken;\r\n        return config;\r\n    };\r\n    axios.interceptors.request.use(function (config) {\r\n        if ((filter && !filter(config)) || config.headers[HEADER_AUTHORIZATION]) {\r\n            return config;\r\n        }\r\n        return acquireToken(function (accessToken, retryable) {\r\n            handled.set(config, retryable);\r\n            return accessToken ? withBearerToken(config, accessToken) : config;\r\n        });\r\n    });\r\n    axios.interceptors.response.use(undefined, function (error) {\r\n        error = error || {};\r\n        return retryOrEnd(acquireToken, error.response, handled.get(error.config), function (accessToken) {\r\n            return axios.create()(withBearerToken(error.config, accessToken));\r\n        }, function () {\r\n            return reject(error);\r\n        });\r\n    });\r\n    return axios;\r\n}\r\n\r\nexport function createFetchMiddleware(app, filter) {\r\n    return fetchMiddleware.bind(0, app.acquireToken, filter);\r\n}\r\n\r\nexport function createAxiosMiddleware(app, filter) {\r\n    return axiosMiddleware.bind(0, app.acquireToken, filter);\r\n}\r\n","import lib from \"brew-js\";\r\nconst errorCode = lib.ErrorCode;\r\nconst { apiError } = errorCode;\r\nexport { apiError };","import { defineHiddenProperty, each, errorWithCode, extend, is } from \"zeta-dom/util\";\r\nimport { combinePath } from \"brew-js/util/path\";\r\nimport * as BrewError from \"brew-js/errorCode\";\r\nimport * as AuthError from \"../errorCode.js\";\r\n\r\nfunction getOptionsWithBody(method, body, options) {\r\n    options = options || {};\r\n    return extend({}, options, {\r\n        method: method,\r\n        body: JSON.stringify(body),\r\n        headers: extend({}, options.headers, {\r\n            'content-type': 'application/json'\r\n        })\r\n    });\r\n}\r\n\r\nfunction handleResult(response, data, error) {\r\n    if (response.ok) {\r\n        return data;\r\n    }\r\n    throw errorWithCode(response.status === 401 ? AuthError.invalidCredential : BrewError.apiError, '', {\r\n        data: data,\r\n        error: error || null,\r\n        status: response.status\r\n    });\r\n}\r\n\r\nfunction fetchJSON(request, next) {\r\n    request.headers.set('accept', 'application/json');\r\n    return (next || fetch)(request).then(function (response) {\r\n        return response.json().then(function (data) {\r\n            return handleResult(response, data);\r\n        }, function (e) {\r\n            // assume empty for non-JSON response with 2xx status\r\n            return handleResult(response, null, e);\r\n        });\r\n    });\r\n}\r\n\r\nfunction JSONClient(baseUrl, middleware) {\r\n    middleware = middleware || function (request, next) {\r\n        return next(request);\r\n    };\r\n    this.baseUrl = baseUrl;\r\n    this.request = function (request, options) {\r\n        request = is(request, Request) || new Request(combinePath(baseUrl, request), options);\r\n        return middleware(request, fetchJSON);\r\n    };\r\n}\r\n\r\neach('get post put patch delete', function (i, v) {\r\n    var method = v.toUpperCase();\r\n    defineHiddenProperty(JSONClient.prototype, v, function (path, body, options) {\r\n        return this.request(path, v === 'get' ? body : getOptionsWithBody(method, body, options));\r\n    });\r\n});\r\n\r\nexport default JSONClient;\r\n","import JSONClient from \"./util/JSONClient.js\";\r\n\r\nexport {\r\n    JSONClient\r\n}\r\n","import Auth from \"./extension.js\";\r\nimport * as AuthError from \"./errorCode.js\";\r\nimport AuthProvider from \"./provider.js\";\r\n\r\nexport default Auth;\r\nexport * from \"./middleware.js\";\r\nexport * from \"./util.js\";\r\n\r\nexport {\r\n    AuthError,\r\n    AuthProvider\r\n}\r\n","import Auth from \"./index.js\";\r\nimport * as methods from \"./index.js\";\r\n\r\nObject.assign(Auth, methods);\r\nexport default Auth;\r\n"],"names":["lib","addExtension","combinePath","_lib$util","util","catchAsync","defineHiddenProperty","defineObservableProperty","each","errorWithCode","exclude","extend","is","isErrorWithCode","isFunction","makeArray","makeAsync","mapRemove","noop","pick","pipe","reject","resolve","resolveAll","throws","reportError","dom","loggedIn","noProvider","invalidCredential","AuthError","CACHE_KEY","app","options","setUser","providers","provider","providerParams","interaction","contexts","Map","redirectUri","location","origin","toHref","sessionCache","cache","previousState","get","isNewSession","performance","navigation","type","currentProvider","currentResult","initProvider","context","revokeSession","accountId","emit","handleLogout","set","init","call","then","key","returnPath","handleLoginRedirect","result","getActiveAccount","e","filterByProp","arr","value","undefined","filter","v","findProvider","params","matched","authType","providerType","loginHint","next","index","isHandleable","setSessionState","popSessionState","state","navigate","handleLogin","resumed","data","account","resolveUser","user","sessionResumed","sessionChanged","error","callProvider","method","callback","promise","define","resolveAuthProvider","acquireToken","force","expiresOn","Date","now","accessToken","refresh","login","postLoginPath","path","bind","logout","postLogoutPath","singleLogout","beforeInit","map","results","indexOf","findIndex","AuthProvider","from","client","storage","window","localStorage","storageKey","storageKeyID","getCachedData","JSON","parse","setCurrentData","stringify","storageArea","oldValue","cached","HEADER_AUTHORIZATION","retryOrEnd","response","retryable","onError","status","fetchMiddleware","request","Request","fetch","headers","has","execute","req","clone","axiosMiddleware","axios","handled","WeakMap","withBearerToken","config","interceptors","use","create","createFetchMiddleware","createAxiosMiddleware","errorCode","ErrorCode","apiError","BrewError","getOptionsWithBody","body","handleResult","ok","fetchJSON","json","JSONClient","baseUrl","middleware","i","toUpperCase","prototype","Auth","methods","Object","assign"],"sourceRoot":""}