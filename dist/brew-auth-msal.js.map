{"version":3,"file":"brew-auth-msal.js","mappings":"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","sources":["webpack://brew-extension-auth-msal/webpack/universalModuleDefinition","webpack://brew-extension-auth-msal/external umd {\"commonjs\":\"@azure/msal-browser\",\"commonjs2\":\"@azure/msal-browser\",\"amd\":\"@azure/msal-browser\",\"root\":\"msal\"}","webpack://brew-extension-auth-msal/external umd {\"commonjs\":\"brew-js\",\"commonjs2\":\"brew-js\",\"amd\":\"brew-js\",\"root\":\"brew\"}","webpack://brew-extension-auth-msal/external umd {\"commonjs\":\"zeta-dom\",\"commonjs2\":\"zeta-dom\",\"amd\":\"zeta-dom\",\"root\":\"zeta\"}","webpack://brew-extension-auth-msal/webpack/bootstrap","webpack://brew-extension-auth-msal/webpack/runtime/define property getters","webpack://brew-extension-auth-msal/webpack/runtime/hasOwnProperty shorthand","webpack://brew-extension-auth-msal/../brew-extension-auth|umd|C:/brew-js/util/common.js","webpack://brew-extension-auth-msal/../brew-extension-auth|umd|C:/brew-js/util/path.js","webpack://brew-extension-auth-msal/../brew-extension-auth|umd|C:/zeta-dom/util.js","webpack://brew-extension-auth-msal/./src/msal.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"@azure/msal-browser\"), require(\"brew-js\"), require(\"zeta-dom\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"@misonou/brew-extension-auth/msal\", [\"@azure/msal-browser\", \"brew-js\", \"zeta-dom\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"MsalAuthProvider\"] = factory(require(\"@azure/msal-browser\"), require(\"brew-js\"), require(\"zeta-dom\"));\n\telse\n\t\troot[\"brew\"] = root[\"brew\"] || {}, root[\"brew\"][\"Auth\"] = root[\"brew\"][\"Auth\"] || {}, root[\"brew\"][\"Auth\"][\"MsalAuthProvider\"] = factory(root[\"msal\"], root[\"brew\"], root[\"zeta\"]);\n})(self, function(__WEBPACK_EXTERNAL_MODULE__735__, __WEBPACK_EXTERNAL_MODULE__760__, __WEBPACK_EXTERNAL_MODULE__231__) {\nreturn ","module.exports = __WEBPACK_EXTERNAL_MODULE__735__;","module.exports = __WEBPACK_EXTERNAL_MODULE__760__;","module.exports = __WEBPACK_EXTERNAL_MODULE__231__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","import lib from \"brew-js\";\r\nconst { getJSON } = lib;\r\nexport { getJSON };","import lib from \"brew-js\";\r\nconst { isSubPathOf } = lib;\r\nexport { isSubPathOf };","import lib from \"zeta-dom\";\r\nconst { define, extend, is } = lib.util;\r\nexport { define, extend, is };","import { EventType, PublicClientApplication } from \"@azure/msal-browser\";\r\nimport { getJSON } from \"brew-js/util/common\";\r\nimport { isSubPathOf } from \"brew-js/util/path\";\r\nimport { define, extend, is } from \"zeta-dom/util\";\r\n\r\nconst AUTHORITY_URI = 'https://login.microsoftonline.com/';\r\n\r\nconst MsalAuthProvider = {};\r\nconst issuerCache = {};\r\nconst multitenant = {\r\n    common: true,\r\n    organizations: true\r\n};\r\nconst defaultConfig = {\r\n    cache: {\r\n        cacheLocation: 'localStorage'\r\n    }\r\n};\r\n\r\nfunction clearInteractionStatus() {\r\n    delete sessionStorage['msal.interaction.status'];\r\n}\r\n\r\nfunction getIssuerURL(domain) {\r\n    return issuerCache[domain] || (issuerCache[domain] = getJSON(AUTHORITY_URI + domain + '/v2.0/.well-known/openid-configuration').then(function (v) {\r\n        return v.issuer;\r\n    }, function (xhr) {\r\n        if (xhr.status === 400) {\r\n            return '';\r\n        }\r\n        delete issuerCache[domain];\r\n    }));\r\n}\r\n\r\n/**\r\n * @param {string} key\r\n * @param {PublicClientApplication} client\r\n * @param {*} options\r\n */\r\nfunction createProvider(key, client, options) {\r\n    var scopes = options.scopes;\r\n\r\n    function refresh(account, context) {\r\n        return client.acquireTokenSilent({\r\n            redirectUri: context.redirectUri,\r\n            account: account,\r\n            scopes: scopes\r\n        });\r\n    }\r\n\r\n    function handleResult(result) {\r\n        if (result) {\r\n            var account = result.account;\r\n            client.setActiveAccount(account);\r\n            return {\r\n                account: account,\r\n                accountId: account.homeAccountId,\r\n                accessToken: result.accessToken,\r\n                expiresOn: result.expiresOn\r\n            };\r\n        }\r\n    }\r\n\r\n    return {\r\n        key: key,\r\n        authType: 'federated',\r\n        providerType: 'msal',\r\n        isHandleable: function (loginHint) {\r\n            if (!/@(.+)$/.test(loginHint)) {\r\n                return false;\r\n            }\r\n            var authority = client.getConfiguration().auth.authority;\r\n            if (multitenant[authority.slice(AUTHORITY_URI.length)]) {\r\n                return true;\r\n            }\r\n            return getIssuerURL(RegExp.$1).then(function (issuer) {\r\n                return !!isSubPathOf(issuer, authority);\r\n            });\r\n        },\r\n        init: function (context) {\r\n            client.enableAccountStorageEvents();\r\n            client.addEventCallback(function (message) {\r\n                if (message.eventType === EventType.ACCOUNT_REMOVED) {\r\n                    context.revokeSession(message.payload.homeAccountId);\r\n                }\r\n            });\r\n            return client.initialize().then(function () {\r\n                return client.handleRedirectPromise();\r\n            }).then(function (result) {\r\n                var account = client.getActiveAccount();\r\n                return result || (account && refresh(account, context));\r\n            }).then(handleResult, function () {\r\n                client.setActiveAccount(null);\r\n            });\r\n        },\r\n        refresh: function (current, context) {\r\n            return refresh(current.account, context).then(handleResult);\r\n        },\r\n        login: function (params, context) {\r\n            var request = {\r\n                redirectUri: context.redirectUri,\r\n                loginHint: params.loginHint,\r\n                scopes: scopes\r\n            };\r\n            clearInteractionStatus();\r\n            if (params.interaction === 'popup') {\r\n                return client.loginPopup(request).then(handleResult);\r\n            } else {\r\n                return client.loginRedirect(request);\r\n            }\r\n        },\r\n        logout: function (params, context) {\r\n            var account = client.getAccount({\r\n                homeAccountId: params.accountId\r\n            });\r\n            if (!params.singleLogout) {\r\n                return client.clearCache({ account });\r\n            }\r\n            clearInteractionStatus();\r\n            if (params.interaction === 'popup') {\r\n                return client.logoutPopup({ account });\r\n            } else {\r\n                return client.logoutRedirect({\r\n                    account: account,\r\n                    postLogoutRedirectUri: context.redirectUri\r\n                });\r\n            }\r\n        }\r\n    };\r\n}\r\n\r\ndefine(MsalAuthProvider, {\r\n    defaultConfig: defaultConfig,\r\n    setDefault: function (config) {\r\n        extend(true, defaultConfig, config);\r\n    },\r\n    create: function (key, options, authority, scopes) {\r\n        if (typeof options === 'string') {\r\n            options = {\r\n                scopes: scopes,\r\n                config: {\r\n                    auth: {\r\n                        clientId: options,\r\n                        authority: authority\r\n                    }\r\n                }\r\n            };\r\n        }\r\n        var client = is(options, PublicClientApplication) || new PublicClientApplication(extend(true, {}, defaultConfig, options.config));\r\n        return createProvider(key, client, options);\r\n    }\r\n});\r\n\r\nexport default MsalAuthProvider;\r\n"],"names":["lib","getJSON","isSubPathOf","_lib$util","util","define","extend","is","EventType","PublicClientApplication","AUTHORITY_URI","MsalAuthProvider","issuerCache","multitenant","common","organizations","defaultConfig","cache","cacheLocation","clearInteractionStatus","sessionStorage","getIssuerURL","domain","then","v","issuer","xhr","status","createProvider","key","client","options","scopes","refresh","account","context","acquireTokenSilent","redirectUri","handleResult","result","setActiveAccount","accountId","homeAccountId","accessToken","expiresOn","authType","providerType","isHandleable","loginHint","test","authority","getConfiguration","auth","slice","length","RegExp","$1","init","enableAccountStorageEvents","addEventCallback","message","eventType","ACCOUNT_REMOVED","revokeSession","payload","initialize","handleRedirectPromise","getActiveAccount","current","login","params","request","interaction","loginPopup","loginRedirect","logout","getAccount","singleLogout","clearCache","logoutPopup","logoutRedirect","postLogoutRedirectUri","setDefault","config","create","clientId"],"sourceRoot":""}